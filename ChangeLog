2020-01-13  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-typify.c (pkl_typify1_ps_cast): Check casts from arrays.
	* testsuite/poke.pkl/cast-array-diag-8.pk: New file.

2020-01-13  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-fold.c (pkl_fold_cdiv): Fix detection of division by zero
	for offsets with implicit magnitudes.
	(pkl_fold_div): Likewise.
	* testsuite/poke.pkl/cdiv-offsets-3.pk: New file.
	* testsuite/poke.pkl/div-offsets-4.pk: Likewise.

2020-01-13  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-fold.c (pkl_fold_mod): Fix detection of division by zero
	for offsets with implicit magnitudes.
	* testsuite/poke.pkl/mod-offsets-5.pk: New file.

2020-01-13  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-anal.c (pkl_anal1_ps_offset): New handler.
	(pkl_phase_anal1): Add handler.
	* testsuite/poke.pkl/offset-type-diag-3.pk: New test.
	* testsuite/poke.pkl/offsets-diag-2.pk: Likewise.
	* doc/poke.texi (Offset Literals): Document that the unit of
	offsets shall be bigger than 0.

2020-01-13  Jose E. Marchesi  <jemarch@gnu.org>

	* TODO: Several updates.

2020-01-13  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-file.c (print_info_file): Use the IO's id as tags.
	(pk_cmd_info_files): Adapt accordingly.
	* testsuite/poke.cmd/file-mode.pk: Adjust accordingly.

2020-01-13  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-lex.l: Ignore form feed characters.
	* testsuite/poke.pkl/formfeedchar.pk: New file.
	* doc/poke.texi (Comments): New chapter.

2020-01-12  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm-val.c (pvm_print_val): Fix printing of hexadecimal
	values with odd widths.
	* testsuite/poke.map/maps-uint-19.pk: Test for the above.

2020-01-12 John Darrington <john@darrington.wattle.id.au>

	* doc/poke.texi: Fixed various typos.

2020-01-12 Egeyar Bagcioglu <egeyar@gmail.com>

	* src/ios.c (ios_get): Remove.
	* src/ios.h (ios_get): Likewise.
	* src/pk-file.c (pk_cmd_file): Replace the bogus call to ios_get
	with ios_search_by_id.
	(pk_cmd_close): Replace the bogus call to ios_get with
	ios_search_by_id.

2020-01-12  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.pkl/chars-1.pk: New file.
	* testsuite/poke.pkl/chars-8.pk: Likewise.
	* testsuite/poke.pkl/chars-7.pk: Likewise.
	* testsuite/poke.pkl/chars-6.pk: Likewise.
	* testsuite/poke.pkl/chars-5.pk: Likewise.
	* testsuite/poke.pkl/chars-4.pk: Likewise.
	* testsuite/poke.pkl/chars-3.pk: Likewise.
	* testsuite/poke.pkl/chars-9.pk: Renamed from chars.pk

2020-01-12  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-lex.l (CHAR): Allow '\r' as character literals.
	* testsuite/poke.pkl/chars-2.pk: New file.

2020-01-12  Jose E. Marchesi  <jemarch@gnu.org>

	* src/ios.c (ios_read_string): Fix detection of EOF.

2020-01-12 Egeyar Bagcioglu <egeyar@gmail.com>

	* src/ios.c (ios_open): Add argument set_cur to control making
	the newly opened IO space the current IO space.
	* src/ios.h (ios_open): Add the new argument, set_cur.
	* src/poke.c (parse_args): Call ios_open with set_cur 1.
	* src/pk-file.c (pk_cmd_file): Likewise.
	* src/pvm.jitter (instruction open): Call ios_open with set_cur 0.
	* testsuite/poke.pkl/close-1.pk: Adjust.
	* testsuite/poke.pkl/set-ios-1.pk: Likewise.

2020-01-12 Egeyar Bagcioglu <egeyar@gmail.com>

	* src/pkl-gen.c (pkl_gen_ps_comp_stmt): Remove PKL_INSN_RETURN from
	PKL_AST_BUILTIN_CLOSE which returns void.
	* src/pvm.jitter (close): Add JITTER_DROP_STACK.

2020-01-11 Egeyar Bagcioglu <egeyar@gmail.com>

	* src/ios.c (ios_write_int_common): Add specifiers "static inline".

2020-01-05  Jose E. Marchesi  <jemarch@gnu.org>

	* src/ras: Stop claiming posix compatibility both as the current
	state and a goal.

2020-01-05  Jose E. Marchesi  <jemarch@gnu.org>

	* bootstrap.conf (gnulib_modules): Import module
	`update-copyright'.

2020-01-03 Egeyar Bagcioglu <egeyar@gmail.com>

	* testsuite/poke.map/maps-uint-write-01.pk: New test.
	* testsuite/poke.map/maps-uint-write-02.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-03.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-04.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-05.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-06.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-07.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-08.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-09.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-10.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-11.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-12.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-13.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-14.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-15.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-16.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-17.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-18.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-19.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-20.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-21.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-22.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-23.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-24.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-25.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-26.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-27.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-28.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-29.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-30.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-31.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-32.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-33.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-34.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-35.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-36.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-37.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-38.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-39.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-40.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-41.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-42.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-43.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-44.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-45.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-46.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-47.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-48.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-49.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-50.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-51.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-52.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-53.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-54.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-55.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-56.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-57.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-58.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-59.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-60.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-61.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-62.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-63.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-64.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-65.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-66.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-67.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-68.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-69.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-70.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-71.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-72.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-73.pk: Likewise.
	* testsuite/poke.map/maps-uint-write-74.pk: Likewise.

2020-01-03 Egeyar Bagcioglu <egeyar@gmail.com>

	* src/ios.c (IOS_PUT_C_ERR_CHCK): New macro.
	(ios_write_int_fast): New function.
	(ios_write_int_common): Likewise.
	(ios_write_int): Rewrite.
	(ios_write_uint): Rewrite.

2020-01-03 Egeyar Bagcioglu <egeyar@gmail.com>

	* src/ios.c (ios_mask_first_byte): Replace this function with ...
	(IOS_CHAR_GET_LSB): ... this macro.
	(ios_mask_last_byte): Replace this function with ...
	(IOS_CHAR_GET_MSB): ... this macro.
	(ios_read_int_common): Replace the calls to ios_mask_first_byte
	and ios_mask_last_byte with IOS_CHAR_GET_LSB and
	IOS_CHAR_GET_MSB, respectively.

2019-12-29 John Darrington <john@darrington.wattle.id.au>

	* src/ios-dev-file.c (ios_dev_file_open): Use a more reliable
	method to determine the file's mode.
	(ios_dev_file_get_mode): New function.
	* src/ios-dev.h (struct ios_dev_if) [get_mode]: New member.
	* src/ios.c (ios_mode): Use method from implementation.
	* src/ios.h (IOS_M_RDONLY): New macro.
	* testsuite/poke.cmd/file-mode.pk: New file.

2019-12-22 John Darrington <john@darrington.wattle.id.au>

	* src/pkl.c (pkl_ast): Fix bugs dealing with path search.

2019-12-22 John Darrington <john@darrington.wattle.id.au>

	* src/pk-cmd.c (pk_cmd_exec_1): Properly initialise argc
	instead of relying on subsequent assignment.

2019-12-21 John Darrington <john@darrington.wattle.id.au>

	* src/pk-file.c (pk_cmd_file): Fix memory leaks and
	check for failures on opening file.

2019-12-21  Jose E. Marchesi  <jemarch@gnu.org>

	* src/std.pk (days_in_month): Simplify the code a bit.

2019-12-16  Dan Čermák  <dan.cermak@cgc-instruments.com>

	* src/pk-repl.c (pk_repl): fix memory leak of poke_history
	* src/pk-cmd.c (pk_cmd_exec): fix memory leak of ecmd
	* src/pk-cmd.c (pk_cmd_exec_1): fix memory leak of filename
	* src/pk-cmd.c (null_cmd): properly initialize struct

2019-12-15 John Darrington <john@darrington.wattle.id.au>

	*src/ios.c (ios_mask_last_byte) simplify
	*src/ios.c (ios_mask_first_byte) simplify

2019-12-16  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-asm.pks (atrim): The mka instruction expects the type of
	the array, not the type of the elements stored in the array.
	* testsuite/poke.pkl/trim-25.pk: New test.

2019-12-15 John Darrington <john@darrington.wattle.id.au>

	* doc/poke.texi (Date and Time Functions): New chapter.
	* src/std.pk (posix_time32): New type.
	* testsuite/poke.std/time32.pk: New file.

2019-12-15 John Darrington <john@darrington.wattle.id.au>

	* doc/poke.texi (Scripts): Elaborate on what scripts are
	(and what they are not).

2019-12-13  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-typify.c (pkl_typify1_ps_ass_stmt): Remove obsolete
	check.
	* testsuite/poke.pkl/ass-function-1.pk: New test.

2019-12-13  Dan Čermák  <dan.cermak@posteo.net>

	* src/pkl-env.c (hash_string): Avoid overflow of signed integers
	in hash calculation.

2019-12-13  Dan Čermák  <dan.cermak@posteo.net>

	* src/pk-cmd.c (pk_cmd_get_next_match): Fix buffer overflow.

2019-12-12  Dan Čermák  <dan.cermak@posteo.net>

	* src/pkl-ast.c (pkl_print_type): Fix call to fprintf to use "%s"
	to print a non-constant string.

2019-12-10  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.c (pkl_ast_type_is_complete): Struct types having
	fields with labels are no complete types.
	(pkl_ast_sizeof_type): Assert if a struct type with field labels
	is not marked as complete.
	* testsuite/poke.pkl/offsets-diag-1.pk: New test.

2019-12-08 John Darrington <john@darrington.wattle.id.au>

	* src/pkl-lex. (CHAR): Accept \\ as a CHAR token.
	* testsuite/poke.pkl/chars.pk: Add new test.
	* doc/poke.texi (Characters): Document new escape sequence.

2019-12-01 John Darrington <john@darrington.wattle.id.au>

	* doc/poke.texi (Offset Literals):  Change the example to agree with the text.

2019-12-10  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-typify.c (pkl_typify1_ps_mul): Do not accept multiplying
	strings.
	* testsuite/poke.pkl/mul-strings-diag-1.pk: New test.

2019-12-10  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-tab.y (offset_type_specifier): Allow integer literals as
	offset units.
	* src/pkl-anal.c (pkl_anal1_ps_type_offset): New handler.
	(pkl_phase_anal1): Install handler.
	* testsuite/poke.pkl/casts-offsets-4.pk: New test.
	* testsuite/poke.pkl/cast-offsets-diag-3.pk: Likewise.
	* doc/poke.texi (Offset Types): Mention using integers as offset
	type units.

2019-12-09  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-cmd.h: Document the value returned by pk_cmd_exec.
	* src/pk-cmd.c (pk_cmd_exec_script): Fix the value returned by the
	function to match the function prototype documentation.
	* src/poke.c (parse_args): Improve the check for the result value
	of pk_cmd_exec_script.
	(initialize_user): Likewise.

2019-12-05  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl.c (pkl_ice): Use an hyperlink for the bug report
	address.
	* src/pkl-asm.c (pkl_asm_catch): Remove obsolete comment.
	* src/pkl-env.c (pkl_env_dup_toplevel): Likewise.

2019-12-05  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-insn.def: New instruction ASETO.
	* src/pvm.jitter (aseto): Define.

2019-12-05  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-typify.c (pkl_typify1_ps_cast): Detect invalid casts,
	and diagnose them.
	* testsuite/poke.pkl/cast-struct-diag-1.pk: New test.
	* testsuite/poke.pkl/cast-offsets-diag-2.pk: Likewise.
	* testsuite/poke.pkl/cast-offsets-diag-1.pk: Likewise.
	* testsuite/poke.pkl/cast-str-diag-1.pk: Likewise.
	* testsuite/poke.pkl/cast-struct-diag-2.pk: Likewise.

2019-12-05  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-fold.c: Define cdivo semantic routines for UUU and III
	cases.
	(pkl_fold_cdiv): Fold /^ operations on offsets.

2019-12-05  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.pkl/offset-arg-1.pk: New test.
	* testsuite/poke.pkl/offset-arg-2.pk: Likewise.

2019-12-05  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-fold.c: Define pkl_fold_gcd using gnulib's <gcd.c.>
	(EMUL_UUU): Define for gcd.
	(pkl_fold_gcd): Define handler.
	(pkl_phase_fold): Register handler.
	(OP_BINARY_OOI): Make sure operands are offsets
	before accessing their magnitude/units.
	(OP_BINARY_OOO): Likewise.
	(OP_BINARY_OOI): Fix handling of base_type.

	* src/pkl-promo.c (promote_offset): Support non-integer units.
	(pkl_promo_ps_op_div): Adjust to new API.
	(pkl_promo_ps_op_add_sub_mod): Likewise.
	(pkl_promo_ps_op_mul): Likewise.
	(pkl_promo_ps_op_rela): Likewise.
	(pkl_promo_ps_type_array): Likewise.
	(pkl_promo_ps_ass_stmt): Likewise.
	(pkl_promo_ps_funcall): Likewise.
	(pkl_promo_ps_return_stmt): Likewise.
	(pkl_promo_ps_func_arg): Likewise.
	(pkl_promo_ps_map): Likewise.
	(pkl_promo_ps_struct_type_field): Likewise.
	(pkl_promo_ps_op_in): Likewise.
	* src/pkl-ops.def: Define PKL_AST_OP_GCD.
	* src/pkl-typify.c (CASE_OFFSET): Use pkl_ast_make_binary_exp and
	do not assume the unit types are integers, but avoid superfluous
	casts whenever possible.
	(CASE_OFFSET): Likewise.
	* src/pkl.c (rest_of_compilation): Run a constant folding phase at
	the beginning of the middle end pass.
	* testsuite/poke.pkl/add-offsets-9.pk: New test.
	* testsuite/poke.pkl/eq-offsets-6.pk: Likewise.
	* testsuite/poke.pkl/eq-offsets-5.pk: Likewise.
	* testsuite/poke.pkl/mod-offsets-4.pk: Likewise.
	* testsuite/poke.pkl/mod-offsets-3.pk: Likewise.
	* testsuite/poke.pkl/div-offsets-3.pk: Likewise.
	* testsuite/poke.pkl/div-offsets-2.pk: Likewise.
	* testsuite/poke.pkl/mul-offsets-9.pk: Likewise.
	* testsuite/poke.pkl/sub-offsets-8.pk: Likewise.
	* testsuite/poke.pkl/sub-offsets-7.pk: Likewise.
	* testsuite/poke.pkl/add-offsets-10.pk: Likewise.

2019-12-01 John Darrington <john@darrington.wattle.id.au>

	* bootstrap.conf: Remove "system"

2019-12-04  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_pr_type_array): Do not calculate the
	array bound when building array types.
	* testsuite/poke.map/maps-arrays-18.pk: New test.

2019-12-04  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-trans.c (pkl_phase_transl): Install
	pkl_transl_{pr,ps}_map handlers for struct type fields.
	(pkl_transl_pr_type_struct): Only break the pass when into a map.
	* testsuite/poke.map/maps-arrays-17.pk: New test.

2019-12-04  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-typify.c (pkl_typify1_ps_if_stmt): New handler.
	(pkl_phase_typify1): Install it.
	* testsuite/poke.pkl/if-diag-1.pk: New test.
	* testsuite/poke.pkl/if-diag-2.pk: Likewise.
	* testsuite/poke.pkl/if-diag-3.pk: Likewise.

2019-12-03  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/elf.pk (Elf64_Sym): New type.
	(STB_LOCAL): New variable.
	(STB_GLOBAL): Likewise.
	(STB_WEAK): Likewise.
	(STB_LOOS): Likewise.
	(STB_HIOS): Likewise.
	(STB_LOPROC): Likewise.
	(STB_HIPROC): Likewise.
	(STV_DEFAULT): Likewise.
	(STV_INTERNAL): Likewise.
	(STV_HIDDEN): Likewise.
	(STV_PROTECTED): Likewise.

2019-12-01 John Darrington <john@darrington.wattle.id.au>

	* doc/poke.texi (dump): Numerous minor changes.

2019-12-01 Luca Saiu <positron@gnu.org>

	* src/pkl-insn.def (PKL_INSN_TUCK): Define new instruction.
	* src/pvm.jitter (rot, nrot): Simplify definition using Jitter
	macro.
	(tuck): New instruction.
	(revn): Add specialized arguments.  Use unsigned JITTER_ARGU0 to
	catch bugs more easily.
	(swap-over-to-tuck): New rewrite rule.
	(rot-swap-to-quake): Re-introduce deleted rewrite rule, which was
	actually correct.
	* pkl-asm.pks (remap, write, addo, subo, mulo, divo, modo, atrim)
	(cdivo, ais, bconc): Simplify and optimize using new instructions.
	* src/pkl-gen.pks (struct_field_mapper): Likewise.
	
2019-12-01 John Darrington <john@darrington.wattle.id.au>

	* src/pk_dump.pk (dump): New parameter cluster_by

2019-12-01 John Darrington <john@darrington.wattle.id.au>

	* doc/poke.texi (dump): Document the dump command.

2019-11-30 John Darrington <john@darrington.wattle.id.au>

	* testsuite/poke.std/crc32.pk: New file.

2019-11-30 John Darrington <john@darrington.wattle.id.au>

	* src/pk-cmd.c (pk_cmd_find):  Use STREQ instead of strcmp.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_pr_map): Fix bug in optimization.
	* testsuite/poke.pkl/map-offset-expr-1.pk: New test.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-asm.pks (atrim): Fix calculation of the resulting mapped
	array offset.
	* testsuite/poke.map/maps-trims-1.pk: New test.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter (siz): Modify to generate a bit-offset in an
	ulong<64> instead of an offset.
	* src/pkl-gen.pks (off_plus_sizeof): Remove.
	(array_mapper): Adapt accordingly.
	(array_valmapper): Likewise.
	(struct_field_mapper): Likewise.
	* src/pkl-asm.pks (array_conv_siz): Likewise.
	* src/pkl-gen.c (pkl_gen_ps_op_attr): Likewise.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks (array_valmapper): Adapt to bit-offsets.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-asm.pks (atrim): Adapt to bit-offsets.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_ps_op_attr): Convert the value returned
	by mgeto to an offset value.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm-val.c (pvm_sizeof): Struct fields now store bit-offsets
	instead of offsets.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_pr_type_offset): Fix regression.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_pr_type_array): Convert sbounds in maps
	to bit-offsets.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks (struct_writer): Adapt to bit-offsets.
	(struct_field_writer): Likewise.
	(array_writer): Likewise.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks (struct_mapper): Use bit-offsets for the struct
	offsets.
	(struct_field_mapper): Likewise.
	(handle_struct_field_label): Likewise.
	(off_plus_sizeof): Likewise.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks (array_mapper): Use bit-offsets for the array
	offsets and for sbound.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_pr_map): Convert map argument to
	bit-offset.
	(pkl_gen_pr_ass_stmt): Likewise.
	(pkl_gen_pr_type_offset): Do not convert to bit-offset.
	(pkl_gen_ps_type_integral): Likewise.
	(pkl_gen_ps_type_string): Likewise.
	* src/pvm.jitter: Remove invalid rot-swap-to-quake rewrite.

2019-11-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter: Update comments to reflect that peek/poke
	instructions get bit-offsets, not regular offsets.

2019-11-24 John Darrington <john@darrington.wattle.id.au>
            * src/pk-file (pk_file_readable): New function.
            (pk_cmd_load_file): Use it to check files before
            opening.

2019-11-24 John Darrington <john@darrington.wattle.id.au>

	* src/pk-term.c: Remove unnecessary #include <sys/stat.h>

2019-11-28  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/lib/poke-dg.exp (dg-data): Avoid appending duplicated
	file names to poke_data_files.
	(poke_finish): Fix deleting the temporary files.

2019-11-28  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter: Add ios_write_string to the list of wrapped
	functions.
	(pokes): Implement instruction.
	* src/ios.c (ios_write_string): Implement.
	* testsuite/poke.map/ass-map-3.pk: New test.
	* testsuite/poke.map/ass-map-4.pk: Likewise.
	* testsuite/poke.map/ass-map-5.pk: Likewise.

2019-11-28  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-anal.c (pkl_anal1_ps_return_stmt): New handler.
	(pkl_phase_anal1): Register it.
	* testsuite/poke.pkl/return-diag-2.pk: New test.

2019-11-28  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-typify.c (pkl_typify1_ps_type_offset): New handler.
	(pkl_phase_typify1): Register it.
	* testsuite/poke.pkl/offset-type-diag-1.pk: New test.
	* testsuite/poke.pkl/offset-type-diag-2.pk: Likewise.

2019-11-24 John Darrington <john@darrington.wattle.id.au>

        * src/std.pk (crc32): New function.
        * doc/poke.texi (CRC Functions): New node.

2019-11-27  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter (quake): New instruction.
	(rot-swap-to-quake): New rewrite rule.

2019-11-24 John Darrington <john@darrington.wattle.id.au>

	* src/pk-cmd.c (pk_cmd_exec_script): Use getline instead
	of a loop and getc.

2019-11-26  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm-alloc.c (pvm_realloc): New function.
	* src/pkl-asm.c (pkl_asm_insn): Remove hard limit
	PKL_AST_MAX_POINTERS, reallocating memory as necessary.
	(pkl_asm_new): Initialize pointers to NULL.

2019-11-26  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/lib/poke-dg.exp (poke-dg-test): Pass -q to poke to
	avoid reading ~/.pokerc.

2019-11-26  Jose E. Marchesi  <jemarch@gnu.org>

	* src/ios.c (IOS_GET_C_ERR_CHCK): Make sure to check get_c return
	value as an int before casting it.
	* src/ios-dev-file.c (ios_dev_file_getc): Do not rely on EOF ==
	IOD_EOF.

2019-11-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.c (pkl_ast_type_is_complete): Handle function types.
	* src/pkl-typify.c (pkl_typify1_ps_op_unmap): New handler.
	* testsuite/poke.pkl/unmap-diag-1.pk: New test.

2019-11-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.c (pkl_ast_type_is_complete): Fix handling of
	structs.

2019-11-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.c (pkl_ast_type_mappable_p): New function.
	* src/pkl-typify.c (pkl_typify1_ps_map): Check for types that
	cannot be mapped and error about it.
	* testsuite/poke.pkl/map-diag-3.pk: Likewise.
	* testsuite/poke.pkl/map-diag-2.pk: Likewise.
	* testsuite/poke.pkl/map-diag-1.pk: New test.
	* testsuite/poke.pkl/map-diag-7.pk: Likewise.
	* testsuite/poke.pkl/map-diag-6.pk: Likewise.
	* testsuite/poke.pkl/map-diag-5.pk: Likewise.
	* testsuite/poke.pkl/map-diag-4.pk: Likewise.

2019-11-22  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.pkl/struct-types-diag-8.pk: Rewrite.

2019-11-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-tab.y (offset_type_specifier): Allow simple types only
	for the offset unit.

2019-11-19 John Darrington <john@darrington.wattle.id.au>

	* doc/poke.texi: Add indeces.

2019-11-19 John Darrington <john@darrington.wattle.id.au>

        * src/pk-dump.pk (print_ascii): New function. (print_hex) New function.
        (print_data): Deal properly with EOF and data not ending on 16#B boundary.
        * testsuite/poke.cmd/dump-5.pk: New file.
        * testsuite/poke.cmd/dump-6.pk: New file.
        * testsuite/poke.cmd/dump-7.pk: New file.

2019-11-17 John Darrington <john@darrington.wattle.id.au>

	* doc/poke.texi (Standard Integral Types): Correct size of nibble.

2019-11-21  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Field Constraints): New section.

2019-11-15  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (__LINE__ and __FILE__): New chapter.

2019-11-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks: Fix handling of sboundm.
	* testsuite/poke.map/maps-arrays-16.pk: New test.

2019-11-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-tab.y: New tokens UU_LINE_UU and UU_FILE_UU.
	* src/pkl-lex.l: Rules for __FILE__ and for __LINE__.
	* testsuite/poke.pkl/uu-line-1.pk: New test.
	* testsuite/poke.pkl/uu-file-1.pk: Likewise.

2019-11-15  Jose E. Marchesi  <jemarch@gnu.org>

	* man/Makefile.am (poke.1): Go back to depend on the source file
	to avoid distcheck to fail.  This time, make sure the executable
	exists before invoking help2man.

2019-11-15  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/leb128.pk: Remove trailing blanks.
	* testsuite/lib/poke-dg.exp: Likewise.
	* src/pvm.jitter: Likeise.
	* src/pkl-typify.c: Likewise.
	* src/pkl-tab.y: Likewise.
	* src/pkl-promo.c: Likewise.
	* src/pkl-gen.c: Likewise.
	* src/pkl-ast.h: Likewise.
	* src/pkl-ast.c: Likewise.
	* src/pk-editor.c: Likewise.
	* testsuite/poke.map/ass-map-1.pk: Remove empty lines at EOF.
	* testsuite/poke.std/atoi-9.pk: Likewise.
	* testsuite/poke.std/atoi-8.pk: Likewise.
	* testsuite/poke.std/atoi-7.pk: Likewise.
	* testsuite/poke.std/atoi-6.pk: Likewise.
	* testsuite/poke.std/atoi-5.pk: Likewise.
	* testsuite/poke.std/atoi-4.pk: Likewise.
	* testsuite/poke.std/atoi-3.pk: Likewise.
	* testsuite/poke.std/atoi-2.pk: Likewise.
	* testsuite/poke.std/atoi-13.pk: Likewise.
	* testsuite/poke.std/atoi-12.pk: Likewise.
	* testsuite/poke.std/atoi-11.pk: Likewise.
	* testsuite/poke.std/atoi-10.pk: Likewise.
	* testsuite/poke.std/atoi-1.pk: Likewise.
	* testsuite/poke.pkl/try-until-3.pk: Likewise.
	* testsuite/poke.pkl/strings-1.pk: Likewise.
	* testsuite/poke.pkl/ass-map-diag-2.pk: Likewise.
	* testsuite/poke.pkl/ass-map-diag-1.pk: Likewise.
	* testsuite/poke.map/maps-offsets-2.pk: Likewise.
	* testsuite/poke.map/maps-offsets-1.pk: Likewise.
	* testsuite/poke.map/maps-ios-1.pk: Likewise.
	* testsuite/poke.map/ass-map-2.pk: Likewise.
	* .x-sc_prohibit_atoi_atof: New file.
	* doc/poke.texi (IO Spaces): s/filesystem/file system/.
	* src/ios.c: Avoid double word in comment.
	* man/Makefile.am (poke.1): Do not use $< in this non-implicit
	rule.

2019-11-13 John Darrington <john@darrington.wattle.id.au>

	* src/pk-cmd.h (completer_t): New typedef.
	(pk_cmd) [completer]: New member;

2019-11-13 John Darrington <john@darrington.wattle.id.au>

	* src/pkl-env.h (pkl_ast_node_iter): New struct.
	(pkl_env_iter_begin): New declaration.
	(pkl_env_iter_next): New declaration.
	(pkl_env_iter_end): New declaration.
	* src/pkl-env.c (pkl_env_iter_begin): New function.
	(pkl_env_iter_next): New function.
	(pkl_env_iter_end): New function.
	(pkl_env_map_decls): Use them to implement this function.

2019-11-13 John Darrington <john@darrington.wattle.id.au>

	* src/pk-cmd.c (cmds): Rename to dot_cmds.
	(pk_cmd_init): Deal with the consequences.

2019-11-14  Jose E. Marchesi  <jemarch@gnu.org>

	* man/Makefile.am: New file.
	* Makefile.am (SUBDIRS): Add the man directory.
	* doc/poke.texi (pokerc): New chapter.
	* configure.ac: Initialize HELP2MAN.

2019-11-14  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-insn.def: peeklu, peekiu, pokelu and pokeiu get two
	arguments, not three.
	* testsuite/poke.pkl/struct-types-endian-1.pk: New test.

2019-11-13  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_ps_op_in): Delete commented out code.

2019-11-13  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Installing Obvious Changes): Fix typo

2019-11-13 John Darrington <john@darrington.wattle.id.au>

	* HACKING (Dejagnu): Fix typo.
	(libtextstyle): Fix typo.

2019-11-13 John Darrington <john@darrington.wattle.id.au>

	* src/pk-repl.c (pk_repl): Remove superfluous tests of the
	variable "line".

2019-11-13 John Darrington <john@darrington.wattle.id.au>

	* src/poke.c (pk_print_version): Update translatable strings.

2019-11-13  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-tab.y: Add missing trailing ';' in the try-until syntax
	rule.

2019-11-13  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Exceptions): Document the ranges of exceptions.

2019-11-13  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.pkl/get-ios-1.pk: New test.
	* testsuite/poke.pkl/get-ios-2.pk: Likewise.
	* testsuite/poke.pkl/set-ios-1.pk: Likewise.
	* testsuite/poke.pkl/close-1.pk: Likewise.
	* testsuite/poke.pkl/open-1.pk: Likewise.

2019-11-13  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (IO Spaces): New section.
	(open): New subsection.
	(close): Likewise.
	(get_ios): Likewise.
	(set_ios): Likewise.
	(The Map Operator): Update to cover the ternary map operator.

2019-11-13  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/lib/poke-dg.exp (dg-data): Accept a file name
	argument.
	(poke_finish): poke_data_files is now a list.
	* testsuite/poke.map/maps-ios-1.pk: New test.
	* testsuite/poke.map/maps-ios-2.pk: Likewise.
	* testsuite/poke.map/maps-ios-3.pk: Likewise.
	* testsuite/poke.map/maps-ios-4.pk: Likewise.
	* testsuite/poke.map/maps-ios-5.pk: Likewise.
	* testsuite/poke.map/maps-ios-6.pk: Likewise.
	* testsuite/poke.map/maps-ios-7.pk: Likewise.

2019-11-12  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter (peeks): Take an IOS argument.
	(PVM_PEEK): Likewise.
	(PVM_POKE): Likewise.
	* src/pkl-gen.c (pkl_gen_pr_map): Pass the IO argument to the
	mappers.
	(pkl_gen_ps_type_integral): Take an IOS argument for mappers and
	writers.
	(pkl_gen_ps_type_string): Likewise.
	(pkl_gen_pr_type_offset): Likewise.
	(pkl_gen_pr_type_array): Likewise.
	(pkl_gen_pr_type_struct): Likewise.
	(pkl_gen_pr_ass_stmt): Pass IOS to the l-value map.
	* src/pkl-gen.pks (array_mapper): Likewise.
	(array_writer): Likewise.
	(struct_mapper): Likewise.
	(struct_field_mapper): Likewise.
	(op_unmap): Set ios to null.
	* src/pkl-asm.pks (write): Pass the mapped object's IOS to the
	writer.
	(remap): Pass the mapped object's IOS to the mapper.
	* src/pkl-tab.y (struct_type_specifier): Register 3 dummies in the
	compile-time lexical environment to reflect lexical changes in
	struct_mapper.
	* testsuite/poke.map/maps-strings-1.pk: New test.
	* testsuite/poke.map/maps-offsets-1.pk: Likewise.
	* testsuite/poke.map/maps-offsets-2.pk: Likewise.

2019-11-12  Jose E. Marchesi  <jemarch@gnu.org>

	* src/ios.c (struct ios): New field `id'.
	(ios_next_id): New static variable.
	(ios_open): Return the id of the opened ios.
	(ios_search_by_id): New function.
	* src/poke.c (parse_args): Adapt to the new interface of ios_open.
	* src/pvm.jitter (close): Use ios_search_by_id.

2019-11-12  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (PKL_AST_BUILTIN_OPEN): Define.
	(PKL_AST_BUILTIN_CLOSE): Likewise.
	* src/pkl-tab.y (builtin): Handle BUILTIN_OPEN and BUILTIN_CLOSE.
	(BUILTIN_OPEN): New token.
	(BUILTIN_CLOSE): Likewise.
	* src/pkl-lex.l: Add __PKL_BUILTIN_OPEN__ and
	__PKL_BUILTIN_CLOSE__.
	* src/pkl-rt.pk (open): Define.
	(close): Likewise.
	* src/pkl-insn.def (open): New instruction.
	(close): Likewise.
	* src/pvm.jitter (open): New instruction.
	(close): Likewise.
	* src/pkl-gen.c (pkl_gen_ps_comp_stmt): Handle
	PKL_AST_BUILTIN_OPEN and PKL_AST_BUILTIN_CLOSE.

2019-11-11  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (PKL_AST_BUILTIN_GET_IOS): Define.
	(PKL_AST_BUILTIN_SET_IOS): Likewise.
	* src/pkl-gen.c (pkl_gen_ps_comp_stmt): Handle get_ios and set_ios
	builtins.
	* src/pkl-insn.def: Define instructions PKL_INSN_PUSHIOS and
	PKL_INSN_POPIOS.
	* src/pvm.jitter (pushios): New instruction.
	(popios): Likewise.
	* src/pkl-rt.pk (get_ios): New function.
	(set_ios): Likewise.
	* src/pkl-lex.l: Rules for __PKL_BUILTIN_GET_IOS__ and
	__PKL_BUILTIN_SET_IOS__.
	* src/pkl-tab.y: Define tokens BUILTIN_GET_IOS and
	BUILTIN_SET_IOS.

2019-11-11  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.c (pkl_ast_make_map): Get an `ios' argument.
	(pkl_ast_node_free): Handle the map ios.
	(pkl_ast_print_1): Likewise.
	* src/pkl-ast.h (struct pkl_ast_map): New attribute `ios'.
	* src/pkl-tab.y (map): Add ternary variant of the operator.
	* src/pkl-pass.c (pkl_do_pass_1): Visit the ios node of maps.
	* src/pkl-typify.c (pkl_typify1_ps_map): Check whether the IOS
	expression evaluates to an integral value.
	(pkl_typify1_ps_attr): The type of the 'io attribute is an
	int<32>.
	* src/pkl-promo.c (pkl_promo_ps_map): Promote the ios argument to
	the map operator.
	* src/pkl-gen.c (pkl_gen_ps_op_attr): Generate code for the 'ios
	attribute.
	* src/pkl-attrs.def: Define PKL_AST_ATTR_IOS.
	* src/pkl-insn.def: New instructions mgetio and msetio.
	* src/pvm.jitter (mgetio): New instruction.
	(msetio): Likewise.
	* testsuite/poke.pkl/map-ios-diag-1.pk: New test.
	* testsuite/poke.pkl/map-ios-diag-2.pk: Likewise.
	* testsuite/poke.pkl/attr-ios-diag-1.pk: Likewise.
	* testsuite/poke.pkl/attr-ios-diag-2.pk: Likewise.
	* src/pvm-val.h (PVM_VAL_IO): Define.
	(PVM_VAL_SET_IO): Likewise.
	(PVM_VAL_ARR_IO): Likewise.
	(PVM_VAL_SCT_IO): Likewise.
	(struct pvm_struct): New field io.
	(struct pvm_array): Likewise.
	* src/pvm-val.c (pvm_make_array): Initialize io.
	(pvm_make_struct): Likewise.

2019-11-12  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-lex.l: Handle token UNTIL.
	* src/pkl-tab.y (UNTIL): New token.
	* src/pkl-ast.h (PKL_AST_TRY_UNTIL_STMT_CODE): Define.
	(PKL_AST_TRY_UNTIL_STMT_EXP): Likewise.
	(struct pkl_ast_try_until_stmt): New struct.
	* src/pkl-ast.c (pkl_ast_make_try_until_stmt): New function.
	(pkl_ast_node_free): Handle try-until AST nodes.
	(pkl_ast_finish_breaks_1): Likewise.
	(pkl_ast_finish_returns_1): Likewise.
	(pkl_ast_print_1): Likewise.
	* src/pkl-pass.c (pkl_do_pass_1): Likewise.
	* src/pkl-typify.c (pkl_typify1_ps_try_until_stmt): New handler.
	* src/pkl-promo.c (pkl_promo_ps_try_until_stmt): Likewise.
	* src/pkl-gen.c (pkl_gen_pr_try_until_stmt): New handler.
	* doc/poke.texi (try-until): New section.
	* testsuite/poke.pkl/try-until-diag-1.pk: New test.
	* testsuite/poke.pkl/try-until-1.pk: Likewise.
	* testsuite/poke.pkl/try-until-2.pk: Likewise.
	* testsuite/poke.pkl/try-until-3.pk: Likewise.

2019-11-12 John Darrington <john@darrington.wattle.id.au>

	* src/pkl-lex.l (YYFATAL_ERROR): Redefine

2019-11-12 John Darrington <john@darrington.wattle.id.au>

	* src/std.pk (ltrim): New function.
	* src/std.pk (rtrim): New function.
	* doc/poke.texi (String Functions): New chapter.
	* testsuite/poke.std/ltrim.pk: New file.
	* testsuite/poke.std/rtrim.pk: New file.

2019-11-12 John Darrington <john@darrington.wattle.id.au>

        * src/pk-file.c (pk_cmd_file): Use strerror for reason.
        (pk_cmd_load_file): ditto.

2019-11-11  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-trans.c (pkl_trans1_ps_string): Handle \".
	* src/pvm-val.c (pvm_print_val): Likewise.
	* testsuite/poke.pkl/strings-1.pk: New test.
	* testsuite/poke.pkl/strings-2.pk: Likewise.
	* testsuite/poke.pkl/strings-3.pk: Likewise.
	* doc/poke.texi (String Literals): Document \".

2019-11-11 John Darrington <john@darrington.wattle.id.au>

	* src/pk-editor.c (pk_cmd_editor): Initialize newline

2019-11-11 John Darrington <john@darrington.wattle.id.au>

	* src/pk-repl.c (pk_repl): Use ~/.poke_history to persist repl
	commands.
	* doc/poke.texi (The REPL): Document the use of readline and the
	poke_history file.

2019-11-11 John Darrington <john@darrington.wattle.id.au>

        * doc/poke.texi (The REPL): Fix typo

2019-11-11  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-print.c: Remove.
	* src/pk-cmd.c (print_cmd): Likewise.
	(cmds): Remove print_cmd.
	* src/Makefile.am (poke_SOURCES): Remove pk-print.c
	* testsuite/poke.map/maps-simple-1.pk: New test.
	* testsuite/poke.map/maps-simple-8.pk: Likewise.
	* testsuite/poke.map/maps-simple-7.pk: Likewise.
	* testsuite/poke.map/maps-simple-6.pk: Likewise.
	* testsuite/poke.map/maps-simple-5.pk: Likewise.
	* testsuite/poke.map/maps-simple-4.pk: Likewise.
	* testsuite/poke.map/maps-simple-3.pk: Likewise.
	* testsuite/poke.map/maps-simple-2.pk: Likewise.
	* testsuite/poke.pkl/sl-1.pk: Do not use .print.
	* testsuite/poke.map/maps-arrays-10.pk: Likewise.
	* testsuite/poke.map/maps-arrays-9.pk: Likewise.
	* testsuite/poke.map/maps-arrays-8.pk: Likewise.
	* testsuite/poke.map/maps-arrays-7.pk: Likewise.
	* testsuite/poke.map/maps-arrays-6.pk: Likewise.
	* testsuite/poke.map/maps-arrays-1.pk: Likewise.
	* testsuite/poke.map/valmaps-arrays.pk: Likewise.
	* testsuite/poke.map/trimmed-map-4.pk: Likewise.
	* testsuite/poke.map/trimmed-map-3.pk: Likewise.
	* testsuite/poke.map/trimmed-map-2.pk: Likewise.
	* testsuite/poke.map/trimmed-map.pk: Likewise.

2019-11-11  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (.file): Add note about blank characters trimming
	from paths.

2019-11-11  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-cmd.c (pk_cmd_exec_1): Do not include trailing blanks in
	tag arguments.

2019-11-11  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (The isa Operator): New chapter.

2019-11-10  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Functions): New chapter.
	(Function Declarations): New section.
	(Optional Arguments): Likewise.
	(Variadic Functions): Likewise.
	(Calling Functions): Likewise.
	(Function Types): Likewise.

2019-11-10  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Write After Approval): Add John Darrington.

2019-11-09  John Darrington  <john@darrington.wattle.id.au>

	* src/pk-repl.c: Include signa.h.
	(poke_sigint_handler): New function.
	(pk_repl): Install signal handler for SIGINT.

2019-11-09  John Darrington  <john@darrington.wattle.id.au>

	* src/ras: Correct punctuation in default error message.

2019-11-09  John Darrington  <john@darrington.wattle.id.au>

	* src/pk-editor.c (pk_cmd_editor): Use xrealloc instead of
	realloc.

2019-11-09  John Darrington  <john@darrington.wattle.id.au>

	* src/pk-editor.c (pk_cmd_editor): Fix memory leak.

2019-11-09  Jose E. Marchesi  <jemarch@gnu.org>

	* configure.ac: Make libreadline a hard requirement.
	* HACKING (readline): Document that now a full implementation of
	readline is required.

2019-11-09  Egeyar Bagcioglu  <egeyar@gmail.com>

	* testsuite/poke.map/maps-int-01.pk: New test.
	* testsuite/poke.map/maps-int-02.pk: Likewise.
	* testsuite/poke.map/maps-int-03.pk: Likewise.
	* testsuite/poke.map/maps-int-04.pk: Likewise.
	* testsuite/poke.map/maps-int-05.pk: Likewise.
	* testsuite/poke.map/maps-int-06.pk: Likewise.
	* testsuite/poke.map/maps-int-07.pk: Likewise.
	* testsuite/poke.map/maps-int-08.pk: Likewise.
	* testsuite/poke.map/maps-int-09.pk: Likewise.
	* testsuite/poke.map/maps-int-10.pk: Likewise.
	* testsuite/poke.map/maps-int-11.pk: Likewise.
	* testsuite/poke.map/maps-int-12.pk: Likewise.
	* testsuite/poke.map/maps-int-13.pk: Likewise.
	* testsuite/poke.map/maps-int-14.pk: Likewise.
	* testsuite/poke.map/maps-int-15.pk: Likewise.
	* testsuite/poke.map/maps-int-16.pk: Likewise.
	* testsuite/poke.map/maps-int-17.pk: Likewise.
	* testsuite/poke.map/maps-int-18.pk: Likewise.
	* testsuite/poke.map/maps-int-19.pk: Likewise.
	* testsuite/poke.map/maps-int-20.pk: Likewise.
	* testsuite/poke.map/maps-int-21.pk: Likewise.
	* testsuite/poke.map/maps-int-22.pk: Likewise.
	* testsuite/poke.map/maps-int-23.pk: Likewise.
	* testsuite/poke.map/maps-int-24.pk: Likewise.
	* testsuite/poke.map/maps-int-25.pk: Likewise.
	* testsuite/poke.map/maps-int-26.pk: Likewise.
	* testsuite/poke.map/maps-int-27.pk: Likewise.
	* testsuite/poke.map/maps-int-28.pk: Likewise.
	* testsuite/poke.map/maps-int-29.pk: Likewise.
	* testsuite/poke.map/maps-int-30.pk: Likewise.
	* testsuite/poke.map/maps-int-31.pk: Likewise.
	* testsuite/poke.map/maps-int-32.pk: Likewise.
	* testsuite/poke.map/maps-int-33.pk: Likewise.
	* testsuite/poke.map/maps-int-34.pk: Likewise.
	* testsuite/poke.map/maps-int-35.pk: Likewise.
	* testsuite/poke.map/maps-int-36.pk: Likewise.
	* testsuite/poke.map/maps-int-37.pk: Likewise.
	* testsuite/poke.map/maps-int-38.pk: Likewise.
	* testsuite/poke.map/maps-int-39.pk: Likewise.
	* testsuite/poke.map/maps-int-40.pk: Likewise.
	* testsuite/poke.map/maps-int-41.pk: Likewise.
	* testsuite/poke.map/maps-int-42.pk: Likewise.
	* testsuite/poke.map/maps-int-43.pk: Likewise.
	* testsuite/poke.map/maps-int-44.pk: Likewise.
	* testsuite/poke.map/maps-int-45.pk: Likewise.
	* testsuite/poke.map/maps-int-46.pk: Likewise.
	* testsuite/poke.map/maps-int-47.pk: Likewise.
	* testsuite/poke.map/maps-int-48.pk: Likewise.
	* testsuite/poke.map/maps-int-49.pk: Likewise.
	* testsuite/poke.map/maps-int-50.pk: Likewise.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Unmapping): New section.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-tab.y (stmt): Set location of assignments to maps.
	* src/pkl-ast.c (pkl_ast_lvalue_p): Allow maps in lvalues.
	* src/pkl-typify.c (pkl_typify1_ps_ass_stmt): The type of a map in
	an l-value shall be simple.
	* src/pkl-gen.c (pkl_gen_pr_ass_stmt): Handle maps in l-values.
	* doc/poke.texi (Assignments): Document maps in l-values.
	* testsuite/poke.pkl/ass-map-diag-1.pk: New test.
	* testsuite/poke.pkl/ass-map-diag-2.pk: Likewise.
	* testsuite/poke.map/ass-map-1.pk: Likewise.
	* testsuite/poke.map/ass-map-2.pk: Likewise.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Conditionals): New chapter.
	(if-else): New section.
	(Loops): New chapter.
	(while): New section.
	(for-in): Likewise.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Exception Handling): New chapter.
	(Exceptions): New section.
	(try-catch): Likewise.
	(raise): Likewise.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* src/std.pk (substr): Remove.
	(strstr): Likewise.
	(format): Likewise.
	* testsuite/poke.std/substr.pk: Remove test.
	* testsuite/poke.std/strstr.pk: Likewise.

2019-11-08  Jose E. Marchesi  <jose.marchesi@oracle.com>

	* doc/poke.texi (Standard Integral Types): New chapter.
	(Standard Offset Types): Likewise.
	(Coversion Functions): Likewise.
	(catos): New section.
	(atoi): Likewise.
	(Sorting Functions): New chapter.
	(qsort): New section.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-repl.c (banner): New function.
	(pk_repl): Call banner.
	(pk_repl_display_begin): Use rl_prompt instead of a literal
	string.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* src/std.pk (catos): Stop at the first null character '\0'.
	* testsuite/poke.std/catos-3.pk: New test.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* bootstrap.conf (gnulib_modules): Import the module unlink from
	gnulib.
	* src/pk-editor.c (pk_cmd_editor): Open result file and extract
	the new line from it.
	Remove the temporary file.
	* doc/poke.texi (.editor): New chapter.

2019-11-07  Jose E. Marchesi  <jemarch@gnu.org>

	* bootstrap.conf (gnulib_modules): Import `system' gnulib module.
	* src/pk-editor.c: New file.
	* src/pk-cmd.c (editor_cmd): New extern.
	(cmds): Add editor_cmd.
	* src/Makefile.am (poke_SOURCES): Add pk_editor.c.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/bpf.pk (BPF_Insn_Opcode._print): Simply using the `in'
	operator.
	(bpf_class_is_alujmp): Likewise.
	* pickles/btf.pk (BTF_Type): Likewise.

2019-11-08  Michael Drüing <michael@drueing.de>

	* src/std.pk (atoi): New function.
	* testsuite/poke.std/atoi-1.pk: New test.
	* testsuite/poke.std/atoi-2.pk: Likewise.
	* testsuite/poke.std/atoi-3.pk: Likewise.
	* testsuite/poke.std/atoi-4.pk: Likewise.
	* testsuite/poke.std/atoi-5.pk: Likewise.
	* testsuite/poke.std/atoi-6.pk: Likewise.
	* testsuite/poke.std/atoi-7.pk: Likewise.
	* testsuite/poke.std/atoi-8.pk: Likewise.
	* testsuite/poke.std/atoi-9.pk: Likewise.
	* testsuite/poke.std/atoi-10.pk: Likewise.
	* testsuite/poke.std/atoi-11.pk: Likewise.
	* testsuite/poke.std/atoi-12.pk: Likewise.
	* testsuite/poke.std/atoi-13.pk: Likewise.

2019-11-08  Jose E. Marchesi  <jose.marchesi@oracle.com>

	* HACKING (Writing poke Tests): New section.

2019-11-08  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-tab.y: Handle compound statements in the parser
	destructor.

2019-11-07  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-repl.h: New file.
	* src/pk-repl.c: Likewise.
	* src/Makefile.am (poke_SOURCES): Add pk-repl.c and pk-repl.h
	* HACKING (Appendix): Add src/pk-repl.h and src/pk-repl.c to the
	list of sources.
	* src/poke.c: Include pk-repl.h
	(repl): Remove function.
	(main): Use pk_repl.

2019-11-06  Darshit Shah  <darnir@gnu.org>

    * bootstrap.conf: Exit out if jitter's bootstrap fails

2019-11-06  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-term.c (pk_term_hyperlink): Fix guard.
	(pk_term_end_hyperlink): Likewise.

2019-11-06  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Write After Approval): Add Darshit Shah to the list of
	commiters.

2019-11-05  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.pkl/union-diag-7.pk: New test.
	* src/pkl-tab.y (struct_type_field): Adjust location for $$ when
	the first token in the rule is empty.

2019-11-05  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Field Endianness): New section.

2019-11-05  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.h (struct pkl_gen_payload): New field endian.
	* src/pkl-gen.pks (struct_field_mapper): Handle field endianness.
	* src/pkl-gen.c (pkl_gen_ps_type_integral): Likewise.
	* src/pkl-asm.c (pkl_asm_insn): Handle PKL_INSN_POKE.
	(pkl_asm_insn_poke): New function.
	* src/pkl-insn.def: Define PKL_INSN_POKE.
	* testsuite/poke.map/maps-structs-endian-1.pk: New test.

2019-11-05  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (PKL_AST_STRUCT_TYPE_FIELD_ENDIAN): Define.
	(enum pkl_ast_endian): New entry PKL_AST_DFL.
	(struct pkl_ast_struct_type_field): New field endian.
	* src/pkl-ast.c (pkl_ast_make_struct_type_field): Handle the
	`endian' attribute.
	(pkl_ast_dup_type): Likewise.
	(pkl_ast_print_1): Likewise.
	* src/pkl-typify.c (pkl_typify1_ps_struct): Likewise.
	* src/pkl-lex.l: Tokens BIG and LITTLE.
	* src/pkl-tab.y (struct_type_field): handle endianness in fields.
	(endianness): New rule.
	* src/pkl-anal.c (pkl_anal2_ps_struct_type_field): New handler.
	(pkl_phase_anal2): Register handler.
	* testsuite/poke.pkl/struct-endian-diag-1.pk: New test.
	* testsuite/poke.pkl/struct-types-endian-diag-2.pk: Likewise.

2019-11-05  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/Makefile.am (POKESTYLESDIR): Define when invoking
	dejagnu.
	* testsuite/lib/poke-dg.exp (dg-require): Mark the test as
	unsupported if appropriate.
	* testsuite/poke.pkl/printf-class-1.pk: Require libtextstyle.
	* testsuite/poke.pkl/printf-class-4.pk: Likewise.
	* testsuite/poke.pkl/printf-class-3.pk: Likewise.
	* testsuite/poke.pkl/printf-class-2.pk: Likewise.

2019-11-05  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Building): it is no longer necessary to pass
	--with-jitter to configure.

2019-11-05  Luca Saiu  <positron@gnu.org>

	* HACKING: Replace "program" to "routine".  Update data
	structure description.  Update debugging and configuration
	information as related to Jitter.  Minor rewording and grammar
	fixes.
	* TODO: Change "program" to "routine".
	* Makefile.am (SUBDIRS): Add jitter.
	* acinclude.m4: Remove file.
	* bootstrap.conf (bootstrap_post_import_hook): New function.
	* configure.ac: Include m4/jitter.m4, now copied from jitter by
	bootstrap.
	(AC_JITTER): Remove along with checks.  Replace with
	AC_JITTER_SUBPACKAGE, which includes tests.
	(--enable-debug, --disable-debug): Remove options.
	(ENABLE_DEBUG): Remove variable.  Remove substitution.
	(POKE_DEBUG): Remove Automake conditional.
	* src/Makefile.am (poke_CPPFLAGS, poke_CFLAGS, poke_LDADD)
	(poke_LDFLAGS): Unconditionalize.
	* src/pvm-val.h: Change to Jitter unified routine API.
	Include jitter/jitter-routine.h to break dependency cycle.
	Add comments.
	(struct pvm_cls): Rename field program to routine, type
	from struct jitter_program * to jitter_routine.
	Change type for field entry_point from void * to
	jitter_program_point.
	(pvm_program): Remove typedef.  Now the include cycle breaking works
	differently.
	* src/pvm-val.c: Change to Jitter unified routine API.
	* src/pk-cmd.c: Change to Jitter unified routine API.
	* src/pk-cmd.h: Change to Jitter unified routine API.
	* src/pk-print.c: Change to Jitter unified routine API.
	* src/pkl-asm.c: Change to Jitter unified routine API.
	* src/pkl-gen.c: Change to Jitter unified routine API.
	* src/pkl-gen.h: Change to Jitter unified routine API.
	* src/pkl.c: Change to Jitter unified routine API.
	* src/pkl.h: Change to Jitter unified routine API.
	* src/pvm-alloc.c: Change to Jitter unified routine API.
	* src/pvm-env.h: Change to Jitter unified routine API.
	* src/pvm.c: Change to Jitter unified routine API.
	* src/pvm.h: Change to Jitter unified routine API.
	* src/ras: Change to Jitter unified routine API.

2019-11-04  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Structs): New chapter.
	(Struct Literals): New section.
	(Struct Types): Likewise.
	(Unions): Likewise.
	(Pinned Structs): Likewise.
	(Struct Attributes): Likewise.
	(Methods): Likewise.
	(Declarations in Structs): Likewise.

2019-11-04  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-asm.pks (remap): Do not check for a null value.

2019-11-04  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-asm.pks (bconc): New macro.
	* src/pkl-asm.c (pkl_asm_insn_bconc): Use bconc macro.
	* src/pkl-fold.c (pkl_fold_bconc): New handler.
	* testsuite/poke.pkl/bconc-1.pk: New file.
	* testsuite/poke.pkl/bconc-2.pk: Likewise.
	* testsuite/poke.pkl/bconc-3.pk: Likewise.
	* testsuite/poke.pkl/bconc-4.pk: Likewise.
	* testsuite/poke.pkl/bconc-5.pk: Likewise.
	* testsuite/poke.pkl/bconc-6.pk: Likewise.

2019-11-04  Jose E. Marchesi  <jemarch@gnu.org>

	* etc/poke-ras-mode.el (poke-ras-mode): Indent labels properly.

2019-11-04  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-asm.pks (ais): Remove unused argument atype.
	* src/pkl-asm.c (pkl_asm_insn_ais): Adjust accordintly.

2019-11-04  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING: Add information about maintainers.

2019-11-03  Darshit Shah  <darnir@gnu.org>

	* m4/libtextstyle-hyperlink.m4: New file with autoconf macro to
	test for hyperlink support in libtextstyle
	* configure.ac: Invoke new macro AX_LIBTEXTSTYLE_HYPERLINK
	* src/pk-term.c (pk_term_hyperlink): Conditionally invoke the
	function styled_ostream_set_hyperlink based on whether
	libtextstyle supports it
	(pk_term_end_hyperlink): Same

2019-11-03  Luca Saiu  <positron@gnu.org>

	* src/Makefile.am (.pks.pkc): Do not rely on GNU Make extension.

2019-11-03  Egeyar Bagcioglu  <egeyar@gmail.com>

	* src/ios.c (ios_read_int): Rewrite.
	(ios_read_uint): Move the common functionality between read_ios_int
	and read_ios_uint from here ...
	(ios_read_int_common): ... to here.

2019-11-03  Darshit Shah  <darnir@gnu.org>

	* bootstrap.conf (MSGID_BUGS_ADDRESS): Fix bug reporting address
	(buildreq): Add a list of build prerequisites
	(gnulib_modules): Sort and split list into separate lines. Also
	deduplicate list (readline, getopt-gnu)
	Remove gendocs-template which is not a gnulib module

2019-11-03  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-insn.def: New instruction ais.
	* src/pkl-asm.c (pkl_asm_insn): Handle AIS.
	(pkl_asm_insn_ais): New function.
	* src/pkl-asm.pks (ais): New macro.
	* src/pkl-gen.c (pkl_gen_ps_op_in): Use PKL_INSN_AIS.
	* doc/poke.texi (Array Elements): New section.

2019-11-02  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ops.def: Define IN operator.
	* src/pkl-tab.y: Rule for the IN binary operator.
	* src/pkl-typify.c (pkl_typify1_ps_op_in): New handler.
	(pkl_phase_typify1): Register handler.
	* src/pkl-promo.c (pkl_promo_ps_op_in): New handler.
	(pkl_phase_promo): Register handler.
	* src/pkl-asm.c (pkl_asm_insn_cmp): Add support for offsets.
	* src/pkl-gen.c (pkl_gen_ps_op_rela): Adjust accordingly.
	* src/pkl-gen.c (pkl_gen_ps_op_in): New handler.
	(pkl_phase_gen): Register handler.
	* testsuite/poke.pkl/in-diag-1.pk: New test.
	* testsuite/poke.pkl/in-diag-2.pk: Likewise.
	* testsuite/poke.pkl/in-diag-3.pk: Likewise.
	* testsuite/poke.pkl/in-diag-4.pk: Likewise.
	* testsuite/poke.pkl/in-3.pk: Likewise.
	* testsuite/poke.pkl/in-2.pk: Likewise.
	* testsuite/poke.pkl/in-1.pk: Likewise.

2019-11-02  Egeyar Bagcioglu  <egeyar@gmail.com>

        * src/ios.c (ios_read_uint): Fix the fast track for 40 bit integers.
        * testsuite/poke.map/maps-uint-41.pk: New test.
        * testsuite/poke.map/maps-uint-42.pk: Likewise.
        * testsuite/poke.map/maps-uint-43.pk: Likewise.
        * testsuite/poke.map/maps-uint-44.pk: Likewise.
        * testsuite/poke.map/maps-uint-45.pk: Likewise.
        * testsuite/poke.map/maps-uint-46.pk: Likewise.
        * testsuite/poke.map/maps-uint-47.pk: Likewise.
        * testsuite/poke.map/maps-uint-48.pk: Likewise.
        * testsuite/poke.map/maps-uint-49.pk: Likewise.
        * testsuite/poke.map/maps-uint-50.pk: Likewise.
        * testsuite/poke.map/maps-uint-51.pk: Likewise.
        * testsuite/poke.map/maps-uint-52.pk: Likewise.
        * testsuite/poke.map/maps-uint-53.pk: Likewise.
        * testsuite/poke.map/maps-uint-54.pk: Likewise.

2019-11-02  Egeyar Bagcioglu  <egeyar@gmail.com>

        * testsuite/poke.map/maps-uint-1.pk: New test.
        * testsuite/poke.map/maps-uint-2.pk: Likewise.
        * testsuite/poke.map/maps-uint-3.pk: Likewise.
        * testsuite/poke.map/maps-uint-4.pk: Likewise.
        * testsuite/poke.map/maps-uint-5.pk: Likewise.
        * testsuite/poke.map/maps-uint-6.pk: Likewise.
        * testsuite/poke.map/maps-uint-7.pk: Likewise.
        * testsuite/poke.map/maps-uint-8.pk: Likewise.
        * testsuite/poke.map/maps-uint-9.pk: Likewise.
        * testsuite/poke.map/maps-uint-10.pk: Likewise.
        * testsuite/poke.map/maps-uint-11.pk: Likewise.
        * testsuite/poke.map/maps-uint-12.pk: Likewise.
        * testsuite/poke.map/maps-uint-13.pk: Likewise.
        * testsuite/poke.map/maps-uint-14.pk: Likewise.
        * testsuite/poke.map/maps-uint-15.pk: Likewise.
        * testsuite/poke.map/maps-uint-16.pk: Likewise.
        * testsuite/poke.map/maps-uint-17.pk: Likewise.
        * testsuite/poke.map/maps-uint-18.pk: Likewise.
        * testsuite/poke.map/maps-uint-19.pk: Likewise.
        * testsuite/poke.map/maps-uint-20.pk: Likewise.
        * testsuite/poke.map/maps-uint-21.pk: Likewise.
        * testsuite/poke.map/maps-uint-22.pk: Likewise.
        * testsuite/poke.map/maps-uint-23.pk: Likewise.
        * testsuite/poke.map/maps-uint-24.pk: Likewise.
        * testsuite/poke.map/maps-uint-25.pk: Likewise.
        * testsuite/poke.map/maps-uint-26.pk: Likewise.
        * testsuite/poke.map/maps-uint-27.pk: Likewise.
        * testsuite/poke.map/maps-uint-28.pk: Likewise.
        * testsuite/poke.map/maps-uint-29.pk: Likewise.
        * testsuite/poke.map/maps-uint-30.pk: Likewise.
        * testsuite/poke.map/maps-uint-31.pk: Likewise.
        * testsuite/poke.map/maps-uint-32.pk: Likewise.
        * testsuite/poke.map/maps-uint-33.pk: Likewise.
        * testsuite/poke.map/maps-uint-34.pk: Likewise.
        * testsuite/poke.map/maps-uint-35.pk: Likewise.
        * testsuite/poke.map/maps-uint-36.pk: Likewise.
        * testsuite/poke.map/maps-uint-37.pk: Likewise.
        * testsuite/poke.map/maps-uint-38.pk: Likewise.
        * testsuite/poke.map/maps-uint-39.pk: Likewise.
        * testsuite/poke.map/maps-uint-40.pk: Likewise.
        * testsuite/poke.map/maps-uint-diag-1.pk: Likewise.

2019-11-02  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-fold.c (EMUL_UUU): For cdiv.
	(EMUL_III): Likewise.
	(pkl_fold_cdiv): New handler.
	* src/pkl-asm.pks (cdiv): New macro.
	(cdivo): New macro.
	* src/pkl-asm.c (pkl_asm_insn_cdivo, pvm_make_integral): New
	function.
	(pkl_asm_insn_cdiv): Likewise.
	(pkl_asm_insn_cdivo): Likewise.
	(pkl_asm_insn): Call pkl_asm_insn_cdiv and pkl_asm_insn_cdivo.
	* src/pkl-insn.def (PKL_INSN_CDIV): New instruction.
	(PKL_INSN_CDIVO): Likewise.
	* src/pkl-gen.c (pkl_gen_ps_op_ceildiv): New handler.
	(pkl_phase_gen): Register the handler.
	* src/pkl-promo.c (pkl_phase_promo): Register pkl_promo_ps_op_div
	to promote ceildiv nodes.
	* src/pkl-typify.c (pkl_typify1_ps_op_ceildiv): New handler.
	(pkl_phase_typify1): Register handler.
	(CASE_OFFSET): Handle ceildiv.
	* src/pkl-ops.def (PKL_AST_OP_CEILDIV): Define.
	* src/pkl-tab.y: New token CEILDIV.
	* src/pkl-lex.l: Rule for CEILDIV.
	* testsuite/poke.pkl/cdiv-offsets-2.pk: Likewise.
	* testsuite/poke.pkl/cdiv-offsets-1.pk: Likewise.
	* testsuite/poke.pkl/cdiv-integers-2.pk: Likewise.
	* testsuite/poke.pkl/cdiv-integers-1.pk: New test.
	* doc/poke.texi (Offset Operations): Document /^ for offsets.
	(Arithmetic Operators): Likewise for integers.

2019-11-02  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (.set): The default endianness is big endian, not
	host endian.

2019-10-30  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Shebang): New section.
	(Scripts): Likewise.
	(Invoking poke): Likewise.

2019-10-30  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter (pvm_literal_printer): Use poke_obase.
	(pvm_literal_printer_lo): Likewise.
	(strace): Likewise.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/bpf.pk (BPF_Insn_Offset): New type.
	(BPF_Insn): Use BPF_Insn_Offset.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/btf.pk (btf_types): New function.
	(btf_strings): Likewise.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Commanding poke): New chapter.
	(The REPL): New section.
	(Evaluation): New section.
	(Commands): Likewise.
	(Scripts): Likewise.
	(Shebang): Likewise.
	(.load): New chapter.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (.vm): New chapter.
	(.vm disassemble): New section.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-fold.c (pkl_fold_pr_type): New handler.
	(pkl_phase_fold): Register handler.
	* src/pkl-promo.c (pkl_promo_pr_type): New handler.
	(pkl_phase_promo): Register handler.
	* src/pkl-typify.c (pkl_typify_pr_type): New handler.
	(pkl_phase_typify1): Register handler.
	Likewise.
	* src/pkl-anal.c: Do not define nor use a pkl_anal_ps_type
	handler.  It is unneccessary.
	* src/pkl-trans.c: Set the `compiled' flag of types AST nodes only
	in trans4.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (struct pkl_ast_type): New field `compiled'.
	(PKL_AST_TYPE_COMPILED): Define.
	* src/pkl-anal.c (pkl_anal_pr_type): Define.
	(pkl_anal_ps_type): Define.
	(pkl_phase_anal1): Registers the handlers.
	(pkl_phase_anal2): Likewise.
	(pkl_phase_analf): Likewise.
	* src/pkl-trans.c (pkl_trans_pr_type): Define.
	(pkl_trans_ps_type): Define.
	(pkl_phase_trans1): Registers the handlers.
	(pkl_phase_trans2): Likewise.
	(pkl_phase_trans3): Likewise.
	(pkl_phase_trans4): Likewise.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_pr_decl): Avoid recompiling type closures
	(mapper, writer, constructor, etc) again and again.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks (struct_constructor): Set/clear
	payload->in_constructor and not payload->in_mapper.
	* testsuite/poke.pkl/struct-types-6.pk: New test.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (.set): New section.
	(.exit): Likewise.
	(.file): Likewise.
	(.info): Likewise.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-lex.l: Remove token TRIMOP.
	* src/pkl-tab.y: Use ':' instead of TRIMOP in trimmers rules.
	* src/std.pk (substr): Adapt to the new syntax.
	* trim.pk: Remove.
	* testsuite/poke.pkl/trim-1.pk: From trim.pk and adapted to new
	syntax.
	* testsuite/poke.pkl/trim-24.pk: Likewise.
	* testsuite/poke.pkl/trim-23.pk: Likewise.
	* testsuite/poke.pkl/trim-22.pk: Likewise.
	* testsuite/poke.pkl/trim-21.pk: Likewise.
	* testsuite/poke.pkl/trim-20.pk: Likewise.
	* testsuite/poke.pkl/trim-19.pk: Likewise.
	* testsuite/poke.pkl/trim-18.pk: Likewise.
	* testsuite/poke.pkl/trim-17.pk: Likewise.
	* testsuite/poke.pkl/trim-16.pk: Likewise.
	* testsuite/poke.pkl/trim-15.pk: Likewise.
	* testsuite/poke.pkl/trim-14.pk: Likewise.
	* testsuite/poke.pkl/trim-13.pk: Likewise.
	* testsuite/poke.pkl/trim-12.pk: Likewise.
	* testsuite/poke.pkl/trim-11.pk: Likewise.
	* testsuite/poke.pkl/trim-10.pk: Likewise.
	* testsuite/poke.pkl/trim-9.pk: Likewise.
	* testsuite/poke.pkl/trim-8.pk: Likewise.
	* testsuite/poke.pkl/trim-7.pk: Likewise.
	* testsuite/poke.pkl/trim-6.pk: Likewise.
	* testsuite/poke.pkl/trim-5.pk: Likewise.
	* testsuite/poke.pkl/trim-4.pk: Likewise.
	* testsuite/poke.pkl/trim-3.pk: Likewise.
	* testsuite/poke.pkl/trim-2.pk: Likewise.
	* testsuite/poke.map/trimmed-map.pk: Adapt to new syntax.
	* testsuite/poke.map/trimmed-map-4.pk: Likewise.
	* testsuite/poke.map/trimmed-map-3.pk: Likewise.
	* testsuite/poke.map/trimmed-map-2.pk: Likewise.

2019-10-29  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Array Indexing): New section.
	(Array Trimming): Likewise.
	(Array Attributes): Likewise.

2019-10-28  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi: New chapters and sections.

2019-10-28  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Integers): New chapter.
	(Integer Literals): New section.
	(Characters): Likewise.
	* testsuite/poke.pkl/printf-value-2.pk: Remove empty line at EOF.
	* testsuite/poke.pkl/printf-value-5.pk: Likewise.

2019-10-27  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Offsets): New chapter.
	(Why offsets): New section.
	(Offset values): Likewise.
	(Offset operations): Likewise.

2019-10-27  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Endianness): New chapter.
	(.set endian): New section.
	(Endian built-ins): Likewise.

2019-10-27  Jose E. Marchesi  <jemarch@gnu.org>

	* bootstrap.conf (gnulib_modules): Import the gendocs-template
	gnulib module.

2019-10-27  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Output): New chapter.
	(print): New section.
	(printf): Likewise.
	(Styling): Likewise.

2019-10-27  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-promo.c (pkl_promo_ps_print_stmt): Fix bug handling %v
	printf arguments.
	* pickles/bpf.pk: Use %v in imm64 pretty-printer.
	* testsuite/poke.pkl/printf-value-5.pk: New test.

2019-10-27  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter (printv): Use the global poke_obase.
	* testsuite/poke.pkl/printf-value-1.pk: .set obase.
	* testsuite/poke.pkl/printf-value-2.pk: Likewise.
	* testsuite/poke.pkl/printf-value-3.pk: Likewise.
	* testsuite/poke.pkl/printf-value-4.pk: New file.

2019-10-26  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (PKL_AST_PRINT_STMT_ARG_PRINT_VALUE_P): Define.
	* src/pkl-trans.c (pkl_trans1_ps_print_stmt): Handle %v tags in
	format strings.
	* src/pkl-typify.c (pkl_typify1_ps_print_stmt): Allow any type for
	%v.
	* src/pkl-asm.c (pkl_asm_insn_print): Issue a `printv' instruction
	to print values in %v tags.
	* src/pkl-insn.def: New instruction printv.
	* src/pvm.jitter (printv): Implement.
	* testsuite/poke.pkl/printf-value-1.pk: New test.
	* testsuite/poke.pkl/printf-value-2.pk: Likewise.
	* testsuite/poke.pkl/printf-value-3.pk: Likewise.

2019-10-26  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Writing Poke): Recommend using the #<...> convention
	for pretty-printed values.

2019-10-26  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/bpf.pk (BPF_Reg): Use styling when printing register
	names.
	(BPF_Insn_Opcode): Likewise for instruction mnemonics.
	* etc/poke-default.css (.insn-register): New class.
	(.insn-mnemonic): Likewise.

2019-10-26  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/bpf.pk (bpf_alu_opcodes): New variable.
	(bpf_jmp_opcodes): Likewise.
	(bpf_ldst_sizes): Likewise.
	(BPF_Insn_Opcode): Pretty printers.
	(BPF_Insn): Pretty printer for imm64.

2019-10-26  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_pr_op_and): New handler.
	(pkl_gen_pr_op_or): Likewise.
	(pkl_gen_ps_op_and): Remove.
	(pkl_gen_ps_op_or): Likewise.
	* testsuite/poke.pkl/and-13.pk: New test.
	* testsuite/poke.pkl/or-4.pk: Likewise.

2019-10-26  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/bpf.pk: New file.
	* pickles/btf.pk: Likewise.
	* pickles/Makefile.am (dist_pkgdata_DATA): Add bpf.pk and btf.pk.

2019-10-26  Egeyar Bagcioglu  <egeyar@gmail.com>

	* bootstrap.conf (gnulib_modules): Import the module byteswap from
	gnulib.
	* src/ios.c (IOS_GET_C_ERR_CHCK): Define.
	(IOS_READ_INTO_CHARRAY_1BYTE): Likewise.
	(IOS_READ_INTO_CHARRAY_2BYTES): Likewise.
	(IOS_READ_INTO_CHARRAY_3BYTES): Likewise.
	(IOS_READ_INTO_CHARRAY_4BYTES): Likewise.
	(IOS_READ_INTO_CHARRAY_5BYTES): Likewise.
	(IOS_READ_INTO_CHARRAY_6BYTES): Likewise.
	(IOS_READ_INTO_CHARRAY_7BYTES): Likewise.
	(IOS_READ_INTO_CHARRAY_8BYTES): Likewise.
	(IOS_READ_INTO_CHARRAY_9BYTES): Likewise.
	(ios_mask_first_byte): New function.
	(ios_mask_last_byte): Likewise.
	(ios_read_uint): Rewrite.

2019-10-25  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Writing RAS): New section.

2019-10-25  Jose E. Marchesi  <jemarch@gnu.org>

	* src/ras: Recognize empty .c lines without a trailing whitespace.

2019-10-25  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/future/bson.pk: Syntax-check fixes.
	* src/pkl.c: Likewise.
	* testsuite/poke.map/maps-structs-methods-5.pk: Likewise.
	* src/pkl-trans.c: Likewise.
	* src/pkl-gen.pks: Likewise.
	* src/pkl-gen.c: Likewise.
	* src/pkl-ast.c: Likewise.
	* src/pkl-anal.c: Likewise.
	* src/ios.c: Likewise.
	* pickles/leb128.pk: Likewise.
	* etc/poke-ras-mode.el: Likewise.
	* testsuite/poke.map/maps-unions-8.pk: Likewise.
	* testsuite/poke.pkl/struct-pretty-print-3.pk: Likewise.
	* testsuite/poke.pkl/struct-pretty-print-1.pk: Likewise.
	* testsuite/poke.pkl/printf-class-2.pk: Likewise.
	* testsuite/poke.pkl/printf-class-1.pk: Likewise.
	* testsuite/poke.map/maps-structs-methods-7.pk: Likewise.
	* testsuite/poke.map/maps-structs-methods-6.pk: Likewise.

2019-10-25  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter (PVM_PEEK): Raise exceptionspa in case of IO
	end-of-file and generic IO error.
	(PVM_POKE): Likewise.
	(peeks): Likewise.
	* src/pkl-gen.c (pkl_gen_pr_map): Do not handle EOF.
	* src/pkl-rt.pk (_pkl_exception_handler): Handle E_io.
	* src/pkl-gen.pks (array_mapper): Adjust to the new handling of
	EOF.
	* testsuite/poke.map/maps-unions-7.pk: New test.
	* testsuite/poke.map/maps-unions-8.pk: Likewise.

2019-10-25  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-anal.c (pkl_anal1_ps_type_struct): Do not allow
	declarations after union fields.
	* testsuite/poke.map/maps-unions-6.pk: Likewise.
	* testsuite/poke.pkl/union-diag-6.pk: Likewise.
	* testsuite/poke.pkl/union-diag-5.pk: Likewise.
	* testsuite/poke.pkl/union-diag-4.pk: New test.

2019-10-24  Jose E. Marchesi  <jose.marchesi@oracle.com>

	* HACKING (Dejagnu): Mention as a dependency.

2019-10-24  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (PKL_AST_BUILTIN_GET_ENDIAN): Define.
	(PKL_AST_BUILTIN_SET_ENDIAN): Likewise.
	* src/pkl-tab.y (BUILTIN_GET_ENDIAN): New token.
	(BUILTIN_SET_ENDIAN): Likewise.
	(builtins): New rule.
	(comp_stmt): Use rule `builtins'.
	* src/pkl-lex.l: Tokens for get_endian and set_endian built-ins.
	* src/pvm.jitter (pushend): New instruction.
	(popend): Likewise.
	* src/pkl-insn.def (PKL_INSN_PUSHEND): Define.
	(PKL_INSN_POPEND): Likewise.
	* src/pkl-rt.pk (get_endian): Define.
	(set_endian): Likewise.
	(ENDIAN_LITTLE): New variable.
	(ENDIAN_BIG): Likewise.
	* src/pkl-gen.c (pkl_gen_ps_comp_stmt): Generate code for
	PKL_AST_BUILTIN_GET_ENDIAN and PKL_AST_BUILTIN_SET_ENDIAN
	builtins.
	* testsuite/poke.pkl/get-endian-1.pk: New test.
	* testsuite/poke.pkl/set-endian-1.pk: Likewise.

2019-10-24  Jose E. Marchesi  <jemarch@gnu.org>

	* src/ios.c (ios_read_uint): Add support for reading 4-bit
	unsigned integers from addresses aligned to 8 or 4 bytes.

2019-10-23  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/Makefile.am (dist_pkgdata_DATA): Add leb128.pk

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.pkl/struct-types-diag-8.pk: New file.
	* testsuite/poke.map/maps-structs-methods-6.pk: Likewise.
	* testsuite/poke.map/maps-structs-methods-7.pk: Likewise.

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-typify.c (pkl_typify1_ps_struct_ref): fix compile-time
	detection of invalid fields in struct references.

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/leb128.pk: Rewritten and moved from future/.
	* etc/poke-default.css (.leb128): New class.

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (struct pkl_ast_print_stmt): New field
	fmt_processed_p.
	(PKL_AST_PRINT_STMT_FMT_PROCESSED_P): Define.
	* src/pkl-trans.c (pkl_trans1_ps_print_stmt): Handle
	fmt_processed_p.
	* HACKING (Middle End Handlers should be Re-executable): New
	section.

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks (struct_mapper): Fix bug in method handling.
	* testsuite/poke.map/maps-structs-methods-5.pk: New file.

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.h: Prototypes for pvm_pretty_print and
	pvm_set_pretty_print.
	* src/pvm.c (pvm_pretty_print): New function.
	(pvm_set_pretty_print): Likewise.
	(PVM_STATE_PRETTY_PRINT): Define.
	* src/pvm.jitter (state-struct-runtime-c): Add pretty_print.
	(state-initialization-c): Initialize pretty_print to 0.
	* src/pk-set.c (pk_cmd_set_pretty_print): New function.
	(set_pretty_print_cmd): New struct.
	(set_cmds): Add set-pretty_print_cmd.
	* src/pvm-val.h: Prototype for pvm_get_struct_method.
	Prototype for pvm_call_cls.
	* src/pvm-val.c (pvm_get_struct_method): New function.
	(pvm_call_pretty_printer): Likewise.
	* testsuite/poke.pkl/struct-pretty-print-1.pk: New file.
	* testsuite/poke.pkl/struct-pretty-print-2.pk: New file.
	* testsuite/poke.pkl/struct-pretty-print-3.pk: Likewise.
	* testsuite/poke.pkl/struct-pretty-print-4.pk: Likewise.

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-typify.c (pkl_typify1_ps_struct_ref): Allow using dot
	notation to refer to struct methods.
	* src/pkl-trans.c (pkl_trans2_ps_struct_ref): Turn struct
	references to parameterless methods into funcalls.
	* src/pvm-val.c (pvm_ref_struct): Allow referencing to methods by
	name.
	* testsuite/poke.map/maps-structs-18.pk: New test.
	* testsuite/poke.map/maps-structs-methods-1.pk: Likewise.
	* testsuite/poke.map/maps-structs-methods-2.pk: Likewise.
	* testsuite/poke.map/maps-structs-methods-3.pk: Likewise.

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter (mksct): Change instruction to get a list of
	methods.
	* src/pkl-gen.pks (struct_mapper): Adapt to the new form of mksct.
	(struct_constructor): Likewise.
	* testsuite/poke.map/maps-structs-14.pk: New test.
	* testsuite/poke.map/maps-structs-15.pk: Likewise.
	* testsuite/poke.map/maps-structs-16.pk: Likewise.
	* testsuite/poke.map/maps-structs-17.pk: Likewise.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm-val.h (PVM_VAL_SCT_METHOD): Define.
	(PVM_VAL_SCT_NMETHODS): Likewise.
	(pvm_make_struct): Add argument nmethods.
	(struct pvm_struct_method): New struct.
	(PVM_VAL_SCT_METHOD_NAME): Define.
	(PVM_VAL_SCT_METHOD_VALUE): Likewise.
	* src/pvm-val.c (pvm_make_struct): Likewise.
	* src/pvm.jitter (mksct): pass the number of methods to
	pvm_make_struct.

2019-10-22  Darkstar <michael@drueing.de>

	* src/poke.c: Several typos in comments fixed.
	(pk_print_version): Likewise.
	(initialize_user): Likewise.

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-trans.c (pkl_trans1_ps_print_stmt): Avoid adding an
	empty suffix to the last arg when a %- tag finished the format
	string.

2019-10-22  Jose E. Marchesi  <jemarch@gnu.org>

	* configure.ac: Warn the user about not finding a full-fledged
	readline.

2019-10-21  Jose E. Marchesi  <jemarch@gnu.org>

	* src/poke.c (repl): print a newline when the user does Ctrl-D.

2019-10-21  Jose E. Marchesi  <jemarch@gnu.org>

	* src/Makefile.am (AM_YFLAGS): Do not pass -y to bison, as we are
	using non-POSIX capabilities.

2019-10-21  Jose E. Marchesi  <jemarch@gnu.org>

	* src/std.pk (catos): New function.
	* testsuite/poke.std/catos-1.pk: New file.
	* testsuite/poke.pkl/catos-2.pk: Likewise.

2019-10-21  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-lex.l (SHEBANG_COMMENT): New context.
	Rules to support multi-line #! ... !# comments.
	* src/poke.c (LOAD_AND_QUIT_ARG): Define.
	(print_help): Document -L.
	(parse_args): Implement -L.

2019-10-21  Jose E. Marchesi  <jemarch@gnu.org>

	* etc/poke-default.css (.error): Bold.

2019-10-21  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.cmd/set-error-on-warning.pk: New test.

2019-10-21  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl.h: Make pkl_error and pkl_warning to get a `compiler'
	option.
	* src/pkl.c (pkl_error_internal): New function.
	(pkl_error): Rewrite to be a wrapper for pkl_error_internal.
	* src/pkl-pass.h (PKL_ERROR): Define.
	(PKL_WARNING): Likewise.
	* src/pkl-anal.c (pkl_anal2_ps_type_struct): Use PKL_WARNING.
	* src/pkl-parser.h (struct pkl_parser): New field `compiler'.
	Make pkl_parse_file and pkl_parse_buffer get a new argument
	`compiler'.
	* src/pkl-parser.c (pkl_parse_file): Get a `compiler' option.
	(pkl_parse_buffer): Likewise.
	* src/pkl.c (pkl_compile_file): Pass `compiler' to pkl_parse_file.
	(pkl_compile_expression): Pass `compiler' to pkl_parse_buffer.
	(pkl_compile_buffer): Likewise.
	(pkl_compile_statement): Likewise.
	* src/pkl-tab.y: Pass pkl_parser->compiler to pkl_error calls.
	* src/pkl-anal.c: Use PKL_ERROR instead of pkl_error for
	diagnostics.
	* src/pkl-fold.c: Likewise.
	* src/pkl-trans.c: Likewise.
	* src/pkl-typify.c: Likewise.

2019-10-20  Jose E. Marchesi  <jemarch@gnu.org>

	* etc/poke-default.css (.dump-ruler): New class.
	(.dump-address): Likewise.
	(.dump-ascii): Likewise.
	* src/pk-dump.pk (dump): Stylize output.

2019-10-20  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/Makefile.am (check-DEJAGNU): Set POKESTYLESDIR.
	* testsuite/poke.pkl/printf-class-1.pk: New test.
	* testsuite/poke.pkl/printf-class-4.pk: Likewise.
	* testsuite/poke.pkl/printf-class-3.pk: Likewise.
	* testsuite/poke.pkl/printf-class-2.pk: Likewise.

2019-10-20  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-trans.c (pkl_trans1_ps_print_stmt): Fix diagnostic for
	unclosed styling class tags.
	* testsuite/poke.pkl/printf-diag-6.pk: New file.
	* testsuite/poke.pkl/printf-diag-7.pk: Likewise.
	* testsuite/poke.pkl/printf-diag-8.pk: Likewise.

2019-10-20  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-promo.c (pkl_promo_ps_print_stmt): Skip arguments
	without associated values.
	* src/pkl-typify.c (pkl_typify1_ps_print_stmt): Likewise.
	* src/pkl-gen.c (pkl_gen_pr_print_stmt): Generate code for styling
	class format directives.
	* src/pkl-trans.c (pkl_trans1_ps_print_stmt): Support %<class: and
	%> format directives.

2019-10-19  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (struct pkl_ast_print_stmt_arg): New fields
	begin_sc and end_sc.
	(PKL_AST_PRINT_STMT_ARG_BEGIN_SC): Define.
	(PKL_AST_PRINT_STMT_ARG_END_SC): Likewise.
	* src/pkl-ast.c (pkl_ast_node_free): Dispose the memory of
	begin_sc and end_sc.
	(pkl_ast_print_1): Print begin_sc and end_sc fields.

2019-10-19  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter (wrapped-functions): Add pk_term_class and
	pk_term_end_class.
	(begsc): New instruction.
	(endsc): Likewise.
	* src/pkl-insn.def: Define instructions begsc and endsc.

2019-10-19  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-pass.h (PKL_PASS_COMPILER): Define.
	(PKL_PASS_SUBPASS): Pass compiler to pkl_do_subpass.
	(PKL_PHASE_BEGIN_HANDLER): The node handler gets a compiler.
	(pkl_do_pass): Get a compiler argument.
	* src/pkl-pass.c (pkl_do_subpass): Handle new argument compiler.
	(pkl_do_pass): Likewise.
	(pkl_call_node_handlers): Likewise.
	(pkl_do_pass_1):  Likewise.
	(PKL_CALL_PHASES): Pass `compiler' to pkl_do_pass_1.
	(PKL_CALL_PHASES_SINGLE): Likewise.
	(PKL_PASS): Likewise.
	(PKL_PASS_CHAIN): Likewise.
	(pkl_do_pass_1): Likewise.
	(pkl_do_subpass): Likewise.
	* src/pkl.c (rest_of_compilation): Pass poke_compiler to
	pkl_do_pass.

2019-10-19  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl.c (struct pkl_compiler): New field error_on_warning.
	(pkl_error_on_warning): New function.
	(pkl_set_error_on_warning): Likewise.
	* src/pkl.h: Prototypes for pkl_error_on_warning and
	pkl_set_error_on_warning.
	* src/pk-cmd.c (pk_cmd_exec_1): Support `-' characters in command
	names.
	* src/pk-set.c (set_error_on_warning_cmd): New variable.
	(pk_cmd_set_error_on_warning): New function.
	(set_cmds): Add set_error_on_warning_cmd.

2019-10-19  Jose E. Marchesi  <jemarch@gnu.org>

	* TODO (#B0 remove hard limit in PKL_AST_MAX_POINTERS): New todo
	entry.
	(#A1 fold "isa" expressions): Likewise.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.map/maps-unions-5.pk: New file.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks (struct_mapper): Generate code for declarations.
	(struct_constructor): Likewise.
	* testsuite/poke.pkl/struct-types-2.pk: New file.
	* testsuite/poke.map/maps-structs-11.pk: Likewise.
	* testsuite/poke.pkl/struct-types-3.pk: Likewise.
	* testsuite/poke.pkl/struct-types-4.pk: Likewise.
	* testsuite/poke.map/maps-structs-12.pk: Likewise.
	* testsuite/poke.pkl/struct-types-5.pk: Likewise.
	* testsuite/poke.map/maps-structs-13.pk: Likewise.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (struct pkl_ast_type): Add nelem and ndecl fields
	to struct types.
	* src/pkl-trans.c (pkl_trans1_ps_type_struct): Count number of
	fields and declarations.
	* src/pkl-ast.c (pkl_ast_print_1): Print nfield and ndecl of
	struct types.
	(pkl_ast_dup_type): Copy ndecl and nfield when
	duplicating struct types.
	(pkl_ast_make_struct_type): Get nfield and ndecl arguments.
	* src/pkl-typify.c (pkl_typify1_ps_struct): Pass extra arguments
	to pkl_ast_make_struct_type.
	* src/pkl-gen.c (pkl_gen_ps_type_struct): Use
	PKL_AST_TYPE_S_NFIELD.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-tab.y (struct_field_type): Fix location of diagnostic
	for duplicated struct elements.
	* src/pkl-anal.c (pkl_anal1_ps_struct): Improve diagnostic.
	* testsuite/poke.pkl/struct-types-diag-5.pk: New test.
	* testsuite/poke.pkl/struct-types-diag-6.pk: Likewise.
	* testsuite/poke.pkl/struct-types-diag-7.pk: Likewise.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-anal.c (pkl_nala1_ps_type_struct): Fix typo in variable
	names.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.c (pkl_gen_pr_decl): Rename type_struct_fields to
	type_struct_elems.
	(pkl_gen_pr_type_struct): Likewise.
	* src/pkl-gen.pks: Adapt to the fact struct type elements can be
	either struct type fields or declarations.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.c (pkl_ast_dup_type): Adapt to the fact struct type
	elements can be either struct type fields or declarations.
	(pkl_ast_sizeof_type): Likewise.
	(pkl_print_type): Likewise.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-typify.c (pkl_typify1_ps_struct_ref): Adapt to the fact
	struct type elements can be either struct type fields or
	declarations.
	(pkl_typify1_ps_scons): Likewise.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-anal.c (pkl_anal1_ps_type_struct): Adapt to the fact
	struct type elements can be either struct type fields or
	declarations.
	(pkl_anal2_ps_type_struct): Likewise.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h: Document that struct elements can be fields or
	declarations.
	* src/pkl-tab.y: Rename the struct_type_field_list rule to
	struct_type_elem_list.
	(struct_type_elem_list): Add declarations.

2019-10-18  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-anal.c (pkl_anal1_ps_type_struct): Rename
	struct_field_type to struct_type_field.
	(pkl_anal2_ps_type_struct): Likewise.
	* src/pkl-typify.c (pkl_typify1_ps_struct): Likewise.
	(pkl_typify1_ps_struct_ref): Likewise.
	(pkl_typify1_ps_scons): Likewise.
	(pkl_typify1_ps_attr): Likewise.
	* src/pkl-tab.y: Likewise.
	* src/pkl-promo.c (pkl_promo_ps_struct_type_field): Likewise.
	* src/pkl-pass.c (pkl_do_pass_1): Likewise.
	* src/pkl-gen.pks (handle_struct_field_name): Likewise.
	(check_struct_field_constraint): Likewise.
	(struct_mapper): Likewise.
	(struct_field_mapper): Likewise.
	* src/pkl-gen.c (pkl_gen_pr_type): Likewise.
	(pkl_gen_pr_type_array): Likewise.
	(pkl_gen_pr_struct_type_field): Likewise.
	* src/pkl-ast.h (enum pkl_ast_code): Likewise.
	(PKL_AST_STRUCT_TYPE_FIELD_NAME): Likewise.
	(PKL_AST_STRUCT_TYPE_FIELD_TYPE): Likewise.
	(PKL_AST_STRUCT_TYPE_FIELD_CONSTRAINT): Likewise.
	(PKL_AST_STRUCT_TYPE_FIELD_LABEL): Likewise.
	(struct pkl_ast_struct_type_field): Likewise.
	* src/pkl-ast.c (pkl_ast_make_struct_field_type): Likewise.
	(pkl_ast_dup_type): Likewise.
	(pkl_ast_sizeof_type): Likewise.
	(pkl_print_type): Likewise.
	(pkl_ast_node_free): Likewise.
	(pkl_ast_print_1): Likewise.

2019-10-17  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-asm.c (pkl_asm_pushlevel): Use pvm_alloc instead of
	malloc.
	(pkl_asm_new): Likewise.
	(pkl_asm_poplevel): Do not free memory.
	(pkl_asm_finish): Likewise.
	* src/pvm-alloc.c (pvm_alloc_initialize): Enable garbage
	collection.

2019-10-17  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl.h: Add an additional POINTERS to pkl_compile_expression.
	* src/pkl.c (pkl_compile_expression): Likewise.
	* src/pk-cmd.c (pk_cmd_exec_1): Keep a `pointers' variable in the
	stack and pass it to pkl_compile_expression.
	* src/pvm-alloc.c (pvm_alloc_initialize): Disable garbage
	collection.

2019-10-16  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-asm.c (pkl_asm_new): fix pasm->pointers initialization.

2019-10-16  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-anal.c (pkl_anal2_ps_type_struct): adjust conditions for
	the "unreachable alternative in union" warning.

2019-10-16  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/future/bson.pk: Rewrite in modern Poke.

2019-10-16  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks (struct_mapper): Raise E_constraint if no valid
	alternatives are found while mapping an union.
	* testsuite/poke.map/maps-unions-3.pk: Fix the test to reflect the
	above change.

2019-10-16  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pvm.jitter (pvm_literal_printer_cast): flush output buffers
	to assure the right order in the output.
	(pvm_literal_printer): Likewise.
	(pvm_literal_printer_hi): Likewise.
	(pvm_literal_printer_lo): Likewise.
	(popf_printer): Likewise.
	(bits_printer): Likewise.
	(endian_printer): Likewise.
	(nenc_printer): Likewise.

2019-10-16  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.pkl/cast-array-diag-5.pk: Fix test.

2019-10-16  Jose E. Marchesi  <jemarch@gnu.org>

	* etc/poke-ras-mode.el: New file.
	* src/pkl-gen.pks: Use poke-ras-mode.
	* src/pkl-asm.pks: Likewise.
	* HACKING (Appendix): Mention etc/poke-ras-mode.el.

2019-10-16  Jose E. Marchesi  <jemarch@gnu.org>

	* src/ras: Support .label directives.
	* src/pkl-gen.pks (struct_mapper): Use .label.

2019-10-16  Jose E. Marchesi  <jemarch@gnu.org>
	    Bruno Haible <bruno@clisp.org>

	* HACKING (Boehm GC): New section.
	(Running an Uninstalled Poke): Mention POKESTYLESDIR.
	(Continuous Integration): New section.
	(Jitter): Clarify instructions on how to install jitter.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/lib/poke-dg.exp (dg-command): Add a comment block
	explaining what the function does.
	(dg-command): Avoid a font-lock problem in Emacs.
	(dg-data): Fix indentation.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* TODO (#A0 fix multi-line warning messages): New todo entry.
	* HACKING (Future Developments): add note about supporting
	compile-time type checking for unions with alternatives with the
	same name.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* etc/poke-default.css: Remove trailing whitespaces.
	* src/pkl.c: Likewise.
	* src/poke.c: Likewise.
	* src/pvm-val.c: Likewise.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-gen.pks (struct_mapper): Support unions in the mapping
	algorithm.
	* testsuite/poke.map/maps-unions-1.pk: New file.
	* testsuite/poke.map/maps-unions-2.pk: Likewise.
	* testsuite/poke.map/maps-unions-3.pk: Likewise.
	* testsuite/poke.map/maps-unions-4.pk: Likewise.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* testsuite/poke.pkl/union-1.pk: Test fixed.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-anal.c (pkl_anal2_ps_type_struct): Pass an AST argument
	to pkl_warning.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-anal.c (pkl_anal2_ps_type_struct): New handler.
	(pkl_phase_anal2): Register pkl_anal2_ps_type_struct.
	* testsuite/poke.pkl/union-diag-1.pk: New file.
	* testsuite/poke.pkl/union-diag-2.pk: Likewise.
	* testsuite/poke.pkl/union-diag-3.pk: Likewise.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-ast.h (struct pkl_ast_type): New field union_p for
	struct types.
	(PKL_AST_TYPE_S_UNION): Define.
	(pkl_ast_make_struct_type): Get an union_p argument.
	* src/pkl-ast.c (pkl_ast_make_struct_type): Initialize union_p.
	(pkl_ast_dup_type): Handle union_p.
	(pkl_ast_print_1): Likewise.
	* src/pkl-tab.y (struct_type_specifier): Pass union_p to
	pkl_ast_make_struct_type.
	* src/pkl-typify.c (pkl_typify1_ps_struct): Likewise.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-lex.l: Support for token union.
	* src/pkl-tab.y (UNION): New token.
	(struct_or_union): New rule.
	(struct_type_specifier): Use struct_or_union.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl.c (pkl_warning): Emit the filename containing the error.
	(pkl_error): Use <stdin> as the filename whenever necessary.
	(pkl_warning): Likewise.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl.c (pkl_detailed_location): Get an additional argument
	specifying the style class to use for terminal output.
	(pkl_error): Pass the style class to pkl_detailed_location.
	(pkl_warning): Likewise.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl.h: Make pkl_warning to get an AST argument.
	* src/pkl.c (pkl_detailed_location): New function.
	(pkl_error): Use pkl_detailed_location.
	(pkl_warning): Likewise.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-file.c (pk_cmd_file): Use pk_printf instead of printf.
	(pk_cmd_close): Likewise.
	(print_info_file): Likewise.
	(pk_cmd_info_files): Likewise.
	(pk_cmd_load_file): Likewise.

2019-10-15  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (libtextstyle): New section.

2019-10-14  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-term.h: Prototypes for pk_term_hyperlink and
	pk_term_end_hyperlink.
	* src/pk-term.c (pk_term_hyperlink): New function.
	(pk_term_end_hyperlink): Likewise.
	* src/poke.c (pk_print_version): Use a terminal hyperlink for the
	GPLv3 webpage.

2019-10-14  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Terminal Handling): New chapter.
	(pk-term): New section.
	(Styling Classes): Likewise.
	(Debugging Styling): Likewise.

2019-10-14  Jose E. Marchesi  <jemarch@gnu.org>

	* configure.ac (ENABLE_DEBUG): ac_subst.
	(WITH_JITTER): Likewise.
	* Makefile.am (AM_DISTCHECK_CONFIGURE_FLAGS): Specify
	--with-jitter and --enable-debug options.
	* src/Makefile.am (poke_SOURCES): Add pkl-insn.def, pkl-ops.def
	and pkl-attrs.def.
	(BUILT_SOURCES): Add pvm-vm.h, pvm-vm1.c and pvm-vm2.c.

2019-10-10  Jose E. Marchesi  <jemarch@gnu.org>

	* etc/poke-default.css: New file.
	* src/pk-term.c: Likewise.
	* Makefile.am (SUBDIRS): Add etc/.
	* src/pvm.jitter: pk_printf is a wrapped function.
	Include pk-term.h in early-c.
	Use pk-term printing services in pretty printers and instructions.
	* src/pvm-val.h: pvm_print_string and pvm_print_val do not take a
	FILE* argument any longer.
	* src/pvm-val.c (pvm_print_binary): Likewise.
	(pvm_print_val): Likewise.
	(pvm_print_string): Likewise.
	* src/poke.c: Include pk-term.h.
	Support --color and --style long options.
	(print_help): Use print services from pk-term.
	(pk_print_version): Likewise.
	(finalize): Shutdown the pk-term subsystem.
	(repl): Likewise.
	(parse_args): Handle --color and -style.
	(initialize): Get argc and argv as arguments.
	(initialize): Initialize the pk-term subsytem.
	(main): Pass argc and argv to `initialize'.
	* src/pkl.c (pkl_new): Likewise.
	(pkl_error): Likewise.
	(pkl_warning): Likewise.
	(pkl_ice): Likewise.
	* src/pk-vm.c (pk_cmd_vm_disas_fun): Use print services from
	pk-term.
	(pk_cmd_vm_disas_map): Likewise.
	(pk_cmd_vm_disas_writ): Likewise.
	* src/pk-term.h: Include textstyle.h.
	Remove obsolete constants.
	Add prototypes for pk-term services.
	* src/pk-set.c: Include pk-term.h.
	(pk_cmd_set_obase): Use print services form pk-term.
	(pk_cmd_set_endian): Likewise.
	(pk_cmd_set_nenc): Likewise.
	* src/pk-print.c: Include pk-term.h.
	(pk_cmd_print): Use print services from pk-term.
	* src/pk-def.c: Include pk-term.h.
	(print_var_decl): Use print services from pk-term.
	(print_fun_decl): Likewise.
	* src/pk-cmd.c: Include pk-term.h.
	(pk_cmd_exec_1): Use print services from pk-term.
	(pk_cmd_exec): Likewise.
	* src/Makefile.am (poke_CPPFLAGS): Add $(top_builddir)/lib to the
	include path.
	* bootstrap.conf (gnulib_modules): Add textstyle-optional.
	* configure.ac: Use gl_LIBTEXTSTYLE_OPTIONAL.
	* src/Makefile.am (poke_LDADD): Link with libtextstyle.
	* testsuite/lib/poke-dg.exp (poke-dg-test): Pass --color=no to
	poke when running tests.
	* testsuite/lib/poke.exp (poke_start): Likewise.
	* HACKING (Appendix):List src/pk-term.c in sources.

2019-10-07  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl.c (pkl_error): Fix truncation of source code sample in
	detailed error output.

2019-10-06  Jose E. Marchesi  <jemarch@gnu.org>

	* .x-sc_trailing_blank: Add TODO.
	* HACKING: Regenerate table of contents.

2019-10-05  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Deciding on What to Work on): New section referring to
	TODO.
	* TODO: Reformat and complete.

2019-10-05  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (Flattening): Add a note about compile-time
	flattening of pinned structs.

2019-10-05  Jose E. Marchesi  <jemarch@gnu.org>

	* doc/poke.texi (String Indexing): New section.
	(String Concatenation): Likewise

2019-10-05  Jose E. Marchesi  <jemarch@gnu.org>

	* src/Makefile.am (poke_CPPFLAGS): Add $(top_builddir)/lib to the
	headers search path.

2019-10-04  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Submitting a Patch): Add a note about running `make
	syntax-check'.

2019-10-04  Jose E. Marchesi  <jemarch@gnu.org>

	* cfg.mk (local-checks-to-skip): Remove sc_trailing_blank.
	* .x-sc_trailing_blanks: New file.
	* pickles/elf.pk: Remove trailing blanks.
	* etc/poke-gdb.scm: Likewise.
	* doc/poke.texi: Likewise.
	* testsuite/poke.std/std.exp: Likewise.
	* testsuite/poke.pkl/try-catch-2.pk: Likewise.
	* testsuite/poke.pkl/structs.pk: Likewise.
	* testsuite/poke.pkl/promo-array-arg-diag-7.pk: Likewise.
	* testsuite/poke.pkl/promo-array-arg-8.pk: Likewise.
	* testsuite/poke.pkl/pkl.exp: Likewise.
	* testsuite/poke.pkl/loop-4.pk: Likewise.
	* testsuite/poke.pkl/loop-3.pk: Likewise.
	* testsuite/poke.pkl/funcall-def-diag-7.pk: Likewise.
	* testsuite/poke.pkl/funcall-def-diag-5.pk: Likewise.
	* testsuite/poke.pkl/funcall-def-2.pk: Likewise.
	* testsuite/poke.pkl/fun-types-4.pk: Likewise.
	* testsuite/poke.pkl/fun-types-3.pk: Likewise.
	* testsuite/poke.pkl/for-in-2.pk: Likewise.
	* testsuite/poke.pkl/defun-12.pk: Likewise.
	* testsuite/poke.pkl/defun-10.pk: Likewise.
	* testsuite/poke.pkl/break-while-2.pk: Likewise.
	* testsuite/poke.pkl/break-while-1.pk: Likewise.
	* testsuite/poke.pkl/break-for-1.pk: Likewise.
	* testsuite/poke.pkl/array-siz-1.pk: Likewise.
	* testsuite/poke.map/maps-structs-constraints-1.pk: Likewise.
	* testsuite/poke.map/maps-arrays-4.pk: Likewise.
	* testsuite/poke.map/map.exp: Likewise.
	* testsuite/poke.cmd/cmd.exp: Likewise.
	* testsuite/lib/poke.exp: Likewise.
	* testsuite/lib/poke-dg.exp: Likewise.
	* src/std.pk: Likewise.
	* src/ras: Likewise.
	* src/pvm.jitter: Likewise.
	* src/pkl-insn.def: Likewise.
	* src/pkl-gen.pks: Likewise.
	* src/pkl-asm.pks: Likewise.
	* src/pk-dump.pk: Likewise.

2019-10-04  Henner Zeller  <h.zeller@acm.org>

	* src/ios-dev.h: Remove trailing spaces.
	* src/ios.c: Likewise.
	* src/ios.h: Likewise.
	* src/pk-cmd.c: Likewise.
	* src/pk-def.c: Likewise.
	* src/pk-file.c: Likewise.
	* src/pk-misc.c: Likewise.
	* src/pk-print.c: Likewise.
	* src/pk-set.c: Likewise.
	* src/pk-vm.c: Likewise.
	* src/pkl-anal.c: Likewise.
	* src/pkl-asm.c: Likewise.
	* src/pkl-asm.h: Likewise.
	* src/pkl-ast.c: Likewise.
	* src/pkl-ast.h: Likewise.
	* src/pkl-env.c: Likewise.
	* src/pkl-fold.c: Likewise.
	* src/pkl-gen.c: Likewise.
	* src/pkl-lex.l: Likewise.
	* src/pkl-parser.c: Likewise.
	* src/pkl-pass.c: Likewise.
	* src/pkl-pass.h: Likewise.
	* src/pkl-promo.c: Likewise.
	* src/pkl-tab.y: Likewise.
	* src/pkl-trans.c: Likewise.
	* src/pkl-trans.h: Likewise.
	* src/pkl-typify.c: Likewise.
	* src/pkl.c: Likewise.
	* src/poke.c: Likewise.
	* src/pvm-alloc.h: Likewise.
	* src/pvm-env.c: Likewise.
	* src/pvm-val.c: Likewise.
	* src/pvm-val.h: Likewise.

2019-10-04  Jose E. Marchesi  <jemarch@gnu.org>

	* cfg.mk (local-checks-to-skip): Add sc_tight_scope.
	* .x-sc_makefile_TAB_only_indentation: New file.
	* .x-sc_prohibit_empty_lines_at_EOF: Likewise.
	* .x-sc_makefile_path_separator_check: Likewise.
	* .x-sc_prohibit_undesirable_word_seq: Likewise.
	* .x-sc_tight_scope: Likewise.
	* testsuite/poke.pkl/rand-1.pk: Remove empty lines at EOF.
	* ChangeLog: Likewise.

2019-10-03  Henner Zeller  <h.zeller@acm.org>

	* .gitignore: ignore src/*.o files.

2019-10-03  Henner Zeller  <h.zeller@acm.org>

	* src/pk-dump.pk (pk_dump_ascii): Default to 1.
	(dump): Provide ASCII output.

2019-10-03  Henner Zeller  <h.zeller@acm.org>

	* src/pkl-trans.c: Include gettext.h and define _ for i18n.
	(pkl_trans1_ps_print_stmt): Handle %c format tags.
	Add more specific (i18n'd) error messages in format-string
	parsing.
	* src/pvm.jitter (PVM_PRINTI): Handle %c.

2019-10-03  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl.c (rest_of_compilation): Do not traverse node types in
	the lex pass.
	* src/pkl-trans.c (pkl_transl_pr_type_struct): New handler.
	* testsuite/poke.map/maps-arrays-15.pk: New test.

2019-10-03  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Building): Mention --skip-po to invoke bootstrap, and
	other updates.

2019-10-03  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Writing Poke): Add a note about using CamelCase for
	type names.

2019-10-02  Jose E. Marchesi  <jemarch@gnu.org>

	* src/std.pk (NULL): New variable.

2019-10-02  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/ctf.pk (ctf_section): Removed, as this replicates logic
	in elf_section_by_name.

2019-10-02  Jose E. Marchesi  <jemarch@gnu.org>

	* src/poke.c (print_help): Fix TRANSLATORS: commands to refer to
	poke.

2019-10-02  gettextize  <bug-gnu-gettext@gnu.org>

	* m4/lib-ld.m4: Upgrade to gettext-0.19.8.1.
	* m4/lib-link.m4: Upgrade to gettext-0.19.8.1.
	* m4/lib-prefix.m4: Upgrade to gettext-0.19.8.1.
	* configure.ac (AM_GNU_GETTEXT_VERSION): Bump to 0.19.8.

2019-10-02  Jose E. Marchesi  <jemarch@gnu.org>

	* Makefile.am (SUBDIRS): Add po/.

2019-10-02  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/elf.pk (Elf64_Addr): turn type into an offset.
	(Elf64_Rela): Adjust accordingly.

2019-10-02  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/elf.pk (elf_section_by_name): New function.
	(elf_section_by_type): Likewise.
	(SHT_DYNSYM): Define.
	(elf_string): Add comment with documentation.

2019-10-01  Jose E. Marchesi  <jemarch@gnu.org>

	* pickles/Makefile.am (dist_pkgdata_DATA): Distribute elf.pk and
	ctf.pk only.
	* pickles/future/bmp.pk: Moved from pickles/
	* pickles/future/tar.pk: Likewise.
	* pickles/future/swf.pk: Likewise.
	* pickles/future/pdp10.pk: Likewise.
	* pickles/future/mp3.pk: Likewise.
	* pickles/future/leb128.pk: Likewise.
	* pickles/future/jpeg.pk: Likewise.
	* pickles/future/id3v2.pk: Likewise.
	* pickles/future/id3v1.pk: Likewise.
	* pickles/future/gzip.pk: Likewise.
	* pickles/future/flv.pk: Likewise.
	* pickles/future/elf-future.pk: Likewise.
	* pickles/future/dwarf.pk: Likewise.
	* pickles/future/deflate.pk: Likewise.
	* pickles/future/bson.pk: Likewise.

2019-10-01  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-file.c (pk_cmd_load_file): Try to load the specified file
	relative to the current working directory, then look in datadir.

2019-09-30  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING: (Nomenclature): New section.

2019-09-30  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Writing C): New section, referring to the GNU Coding
	Standards.
	(Submitting a Patch): New section.

2019-09-11  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (readline): New section in Development Environment,
	about the dependency libreadline.

2019-09-07  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-cmd.c (pk_cmd_exec_1): Avoid a buffer overrun when
	doing tilde expansion in file names.

2019-09-07  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Jitter): Documment a set of recommended switches to use
	when configuring jitter.

2019-09-07  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Adding Compiler Built-Ins): New section.

2019-09-07  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pk-cmd.c (skip_blanks): handle p == NULL.

2019-09-07  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-promo.c (pkl_promo_ps_op_unary): Initialize `restart'.
	* src/pkl-lex.l: Avoid a dead initialization.
	* src/pkl.c (pkl_error): Likewise.
	* src/pkl-typify.c (pkl_typify1_ps_funcall): Likewise.
	* src/pkl-gen.c (pkl_gen_pr_ass_stmt): Likewise.
	* src/pkl-asm.c (pkl_asm_insn): Avoid the possibility of a NULL
	deference.

2019-09-06  Jose E. Marchesi  <jemarch@gnu.org>

	* src/pkl-insn.def: New instruction RAND.
	* src/pvm.jitter (rand): New instruction.
	(wrapped-functions): Add wrapper for `random'.
	* bootstrap.conf (gnulib_modules): Add `random' gnulib module.
	* src/pkl-ast.h (PKL_AST_BUILTIN_RAND): Define.
	* src/pkl-gen.c (pkl_gen_ps_comp_stmt): Emit code for the RAND
	built-int.
	* src/pkl-lex.l: Recognize BUILTIN_RAND token.
	* src/pkl-tab.y: Define token BUILTIN_RANDR.
	(comp_stmt): New rule for builtin randr.
	* testsuite/poke.pkl/rand-1.pk: New file.

2019-09-06  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Jitter): Replace git:// URL with an http://, for
	jitter.
	(Development Environment): Add a note about setting POKEDATADIR to
	run an uninstalled poke.

2019-09-06  Jose E. Marchesi  <jemarch@gnu.org>

	* HACKING (Jitter): Add information on the dependency on jitter.
